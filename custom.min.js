var COLOR_INTERP_LAB=1,COLOR_INTERP_JAB=2,COLOR_INTERP_ELSE=10;function isLabColor(t){return null!=t&&!isNaN(t.l)&&!isNaN(t.a)&&!isNaN(t.b)}function isJabColor(t){return null!=t&&!isNaN(t.J)&&!isNaN(t.a)&&!isNaN(t.b)}function ColorInterpolator(t,e,r){isLabColor(t)||isLabColor(e)||"lab"===r?(this.c1=d3.lab(t),this.c2=d3.lab(e),this.interpType=COLOR_INTERP_LAB):isJabColor(t)||isJabColor(e)||"jab"===r?(this.c1=d3.jab(t),this.c2=d3.jab(e),this.interpType=COLOR_INTERP_JAB):this.interpType=COLOR_INTERP_ELSE}function ColorMap(t,e){isFunction(t)?this.colormapFunc=t:t&&this.setMap(t,e)}ColorInterpolator.prototype.interpolate=function(t){var e=this.c1,r=this.c2;return this.interpType==COLOR_INTERP_LAB?d3.lab(e.l+t*(r.l-e.l),e.a+t*(r.a-e.a),e.b+t*(r.b-e.b)):this.interpType==COLOR_INTERP_JAB?d3.jab(e.J+t*(r.J-e.J),e.a+t*(r.a-e.a),e.b+t*(r.b-e.b)):null},ColorMap.prototype.getColorSet=function(){return this.colorMap},ColorMap.prototype.setMap=function(t,e){if(e||(e="lab"),e="lab",this.colorMap=t||this.colorMap,this.colorInterpolator=[],this.interpType=e,t.length>1)for(var r=0,o=t.length;r<o-1;r++){var a=[t[r].value,t[r+1].value],i=null;if(t[r].lab&&t[r+1].lab){var n=t[r].lab,s=t[r+1].lab;if(isLabColor(n)&&(n=[n.l,n.a,n.b]),isLabColor(s)&&(s=[s.l,s.a,s.b]),"lab"==e)i=new ColorInterpolator(d3.lab(n[0],n[1],n[2]),d3.lab(s[0],s[1],s[2]));else if("jab"==e){i=new ColorInterpolator(d3.jab(d3.lab(n[0],n[1],n[2])),d3.jab(d3.lab(s[0],s[1],s[2])))}else i="hsl"==e?d3.interpolateHsl(d3.lab(n[0],n[1],n[2]),d3.lab(s[0],s[1],s[2])):d3.interpolateRgb(d3.lab(n[0],n[1],n[2]),d3.lab(s[0],s[1],s[2]))}else{var l=t[r].rgb,c=t[r+1].rgb;i="lab"==e?d3.interpolateLab(d3.rgb(l[0],l[1],l[2]),d3.rgb(c[0],c[1],c[2])):"hsl"==e?d3.interpolateHsl(d3.rgb(l[0],l[1],l[2]),d3.rgb(c[0],c[1],c[2])):d3.interpolateRgb(d3.rgb(l[0],l[1],l[2]),d3.rgb(c[0],c[1],c[2]))}this.colorInterpolator.push({interpType:"lab"==e?1:0,interpolator:i,range:a,_len:1/(a[1]-a[0])})}},ColorMap.prototype.getMinMax=function(){return this.colormapFunc?[0,1]:0==this.colorMap.length?null:[this.colorMap[0].value,this.colorMap[this.colorMap.length-1].value]},ColorMap.prototype.addColor=function(){for(var t=this.getMinMax(),e=this.colorMap.length+1,r=[],o=0;o<e;o++){var a=o/(e-1)*(t[1]-t[0])+t[0],i=this.mapValue(a);r.push({value:a,rgb:[i.r,i.g,i.b]})}this.setMap(r,this.interpType)},ColorMap.prototype.removeColor=function(){if(!(this.colorMap.length<=2)){for(var t=this.getMinMax(),e=this.colorMap.length-1,r=[],o=0;o<e;o++){var a=o/(e-1)*(t[1]-t[0])+t[0],i=this.mapValue(a);r.push({value:a,rgb:[i.r,i.g,i.b]})}this.setMap(r,this.interpType)}},ColorMap.prototype.createGPUColormap=function(t){void 0!==this.gpuTexture&&this.dispose();var e=document.createElement("canvas");e.width=1024,e.height=1,t||(t=this),t.drawColorScale(e.width,e.height,1024,"horizontal",e);var r=new THREE.CanvasTexture(e,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,THREE.UnsignedByteType);return r.needsUpdate=!0,this.gpuTexture=r,r},ColorMap.prototype.dispose=function(){void 0!==this.gpuTexture&&(this.gpuTexture.dispose(),this.gpuTexture=void 0)},ColorMap.prototype.sampleRamp=function(t){t||(t=9);for(var e=[],r=0;r<t;r++){var o=this.mapValue(r/(t-1));e.push(o)}return e},ColorMap.prototype.visualize=function(t){var e=t.select("g.colorRectGroup");0==e.size()&&(e=t.append("g").attr("class","colorRectGroup").attr("transform","translate(15,15)"));var r=t.select("g.colorLightnessCurve");0==r.size()&&(r=t.append("g").attr("class","colorLightnessCurve").attr("transform","translate(45,15)")),r.selectAll("*").remove();var o=t.select("g.colorScale");0==o.size()&&(o=t.append("g").attr("class","colorScale").attr("transform","translate(80,15)")),o.selectAll("*").remove();var a=210,i=document.createElement("canvas");i.width=25,i.height=a,this.drawColorScale(i.width,i.height,105,"vertical",i),o.append("image").attr("width",40).attr("height",a).attr("x",-70).attr("y",0).attr("xlink:href",i.toDataURL());for(var n=[],s=[],l=this.getMinMax(),c=0,h=50;c<h;c++){var u=(l[1]-l[0])*(c/(h-1))+l[0],d=this.mapValue(u),p=d3.lab(d3.rgb(d.r,d.g,d.b));n.push({x:40*p.l/100,y:a-a*c/(h-1)})}for(c=0,h=this.colorDiffs.length;c<h;c++){var g=this.colorDiffs[c];s[c]={x:40*g,y:a-a*c/(h-1)}}r.append("rect").style("fill","none").style("stroke","#444444").style("stroke-width","0.5px").attr("width",40).attr("height",a);var f=d3.svg.line().x((function(t){return t.x})).y((function(t){return t.y}));r.append("path").attr("d",f(n)).style("stroke","#af010a").style("stroke-width","1px").style("fill","none"),r.append("path").attr("d",f(s)).style("stroke","black").style("stroke-width","1px").style("fill","none")},ColorMap.prototype.computeColorDiff=function(t,e){for(var r=void 0===t||void 0===e?[0,1]:[t,e],o=null,a=[],i=-Number.MAX_VALUE,n=0,s=0,l=0;l<50;l++){var c=l/49*(r[1]-r[0])+r[0],h=this.mapValue(c),u=d3.lab(d3.rgb(h.r,h.g,h.b));if(o){var d=ciede2000(u.l,u.a,u.b,o.l,o.a,o.b);a.push(d),i=Math.max(d,i),n+=d,s++}else a.push(0);o=u}return this.avgDiff=n/s,this.colorDiffs=a,this.maxColorDiff=i,{avgDiff:this.avgDiff,diffValues:a,maxColorDiff:this.maxColorDiff}},ColorMap.prototype.scaleColorDiff=function(t){console.log("scale color diff: "+t);for(var e=this.colorDiffs,r=0,o=e.length;r<o;r++)e[r]/=t},ColorMap.prototype.mapValue=function(t,e){if(this.colormapFunc)return this.colormapFunc(t);for(var r=this.colorInterpolator,o=0,a=r.length;o<a;o++){var i=r[o],n=i.range;if(n[0]<=t&&n[1]>=t){var s,l=(t-n[0])*i._len,c=i.interpolator;return ColorInterpolator.prototype.isPrototypeOf(c)?(s=c.interpolate(l),d3.rgb(s)):s=c(l)}}return null},ColorMap.prototype.drawColorScale=function(t,e,r,o,a,i){var n=this.getMinMax(),s=a||document.createElement("canvas");a||(s.width=t,s.height=e);var l,c,h,u,d,p,g=s.getContext("2d"),f="vertical"==o?e/r:t/r;"vertical"==o?(h=0,u=-f,d=t,p=f,l=0,c=e-f):(h=f,u=0,d=f,p=e,l=0,c=0);for(var m=e>4,v=0;v<r;v++,l+=h,c+=u){var b=(n[1]-n[0])*((i?r-1-v:v)/(r-1))+n[0],y=this.mapValue(b,m);g.fillStyle=null!==y?y.toString():"#000000",g.fillRect(l,c,d,p),null===y&&(g.strokeStyle="#FFFF00",g.lineWidth=2,g.beginPath(),g.moveTo(l,e/2),g.lineTo(l+d,e/2),g.stroke())}return s};var COLOR_PRESETS={tealbeige:["#e6ebb4","#c8d991","#a6da93","#83d99e","#62d1a7","#44bea6","#359f96","#387372","#353836"].reverse(),pinkpurple:["#fcebe2","#facac3","#f9aeb9","#f992b1","#f872a5","#ef4d9f","#d01e91","#9e0077","#7d0078"].reverse(),greenmelon:["#e6ebb4","#c8d991","#a6da93","#83d99e","#62d1a7","#44bea6","#359f96","#387372","#353836"].reverse(),redmelon:["#d13d6b","#d8595c","#dd704c","#e18739","#e3a227","#e0c135","#dcdd64","#daeb96","#dee7bd"],bluebrown:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"].reverse(),bluebrownFull:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"].reverse(),bluered:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"].reverse(),greenpink:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"].reverse(),greenpinkFull:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"].reverse(),greenpinkBrewer:["#c5147e","#d964a2","#ea9dcb","#fbd0e8","#f6f8f6","#def4c7","#bbe792","#86c950","#42931d"].reverse(),orangegreen:["#d38812","#f2b756","#fed39a","#fbe3d3","#f3f4ef","#edffe3","#dfffba","#c3ff84","#94d059"].reverse(),bluebrownBrewer:["#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f"].reverse(),purpleorange:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"].reverse(),purpleorangeFull:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"].reverse(),greenpurple:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"].reverse(),greenpurpleFull:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"].reverse(),bluegreenyellow:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"].reverse(),blueyellowred:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"].reverse(),bluebrown2:[{x:"0",o:"1",r:"0.164706",g:"0.207843",b:"0.239216"},{x:"0.025",o:"1",r:"0.184314",g:"0.258824",b:"0.301961"},{x:"0.05",o:"1",r:"0.188235",g:"0.301961",b:"0.360784"},{x:"0.1",o:"1",r:"0.184314",g:"0.403922",b:"0.478431"},{x:"0.15",o:"1",r:"0.211765",g:"0.533333",b:"0.6"},{x:"0.2",o:"1",r:"0.211765",g:"0.682353",b:"0.701961"},{x:"0.25",o:"1",r:"0.278431",g:"0.8",b:"0.784314"},{x:"0.3",o:"1",r:"0.388235",g:"0.901961",b:"0.831373"},{x:"0.35",o:"1",r:"0.490196",g:"0.941176",b:"0.819608"},{x:"0.4",o:"1",r:"0.576471",g:"0.960784",b:"0.8"},{x:"0.45",o:"1",r:"0.792157",g:"0.988235",b:"0.87451"},{x:"0.49",o:"1",r:"0.878431",g:"1",b:"0.921569"},{x:"0.5",o:"1",r:"0.988235",g:"0.972549",b:"0.831373"},{x:"0.55",o:"1",r:"0.921569",g:"0.866667",b:"0.607843"},{x:"0.6",o:"1",r:"0.890196",g:"0.807843",b:"0.505882"},{x:"0.65",o:"1",r:"0.839216",g:"0.721569",b:"0.447059"},{x:"0.7",o:"1",r:"0.760784",g:"0.631373",b:"0.372549"},{x:"0.75",o:"1",r:"0.65098",g:"0.568627",b:"0.298039"},{x:"0.8",o:"1",r:"0.541176",g:"0.513725",b:"0.239216"},{x:"0.85",o:"1",r:"0.439216",g:"0.439216",b:"0.184314"},{x:"0.9",o:"1",r:"0.305882",g:"0.360784",b:"0.12549"},{x:"0.95",o:"1",r:"0.203922",g:"0.258824",b:"0.117647"},{x:"1",o:"1",r:"0.117647",g:"0.160784",b:"0.098039"}],greyscale:[[0,0,0],[255,255,255]],rainbow:[[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,0,0]],rainbowFull:[[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,0,0],[255,0,255]],rainbowcie:[[0,0,255],[0,255,255],[0,255,0],[255,255,0],[255,0,0]],rainbowjet:[[0,0,143],[0,0,159],[0,0,175],[0,0,191],[0,0,207],[0,0,223],[0,0,239],[0,0,255],[0,15,255],[0,31,255],[0,47,255],[0,63,255],[0,79,255],[0,95,255],[0,111,255],[0,127,255],[0,143,255],[0,159,255],[0,175,255],[0,191,255],[0,207,255],[0,223,255],[0,239,255],[0,255,255],[15,255,239],[31,255,223],[47,255,207],[63,255,191],[79,255,175],[95,255,159],[111,255,143],[127,255,127],[143,255,111],[159,255,95],[175,255,79],[191,255,63],[207,255,47],[223,255,31],[239,255,15],[255,255,0],[255,239,0],[255,223,0],[255,207,0],[255,191,0],[255,175,0],[255,159,0],[255,143,0],[255,127,0],[255,111,0],[255,95,0],[255,79,0],[255,63,0],[255,47,0],[255,31,0],[255,15,0],[255,0,0],[239,0,0],[223,0,0],[207,0,0],[191,0,0],[175,0,0],[159,0,0],[143,0,0],[127,0,0]],cubehelix:[[0,0,0],[.017,.006,.016],[.032,.011,.033],[.046,.018,.051],[.059,.025,.07],[.07,.032,.089],[.08,.041,.109],[.087,.05,.129],[.094,.06,.15],[.098,.071,.169],[.102,.083,.188],[.104,.095,.207],[.104,.109,.224],[.104,.123,.24],[.103,.138,.254],[.1,.153,.267],[.098,.169,.279],[.095,.186,.288],[.092,.203,.296],[.089,.221,.302],[.086,.238,.306],[.084,.256,.308],[.083,.274,.308],[.082,.291,.306],[.083,.308,.303],[.085,.325,.298],[.089,.341,.292],[.094,.357,.284],[.101,.372,.276],[.109,.386,.267],[.12,.399,.257],[.133,.412,.247],[.147,.423,.237],[.164,.434,.227],[.183,.443,.217],[.203,.451,.209],[.225,.458,.201],[.249,.464,.194],[.275,.469,.189],[.301,.473,.186],[.329,.476,.184],[.358,.478,.184],[.388,.48,.186],[.418,.481,.19],[.449,.481,.197],[.48,.48,.206],[.511,.479,.218],[.541,.478,.231],[.571,.477,.247],[.6,.476,.266],[.628,.475,.286],[.654,.474,.309],[.679,.474,.334],[.703,.474,.36],[.725,.474,.388],[.745,.476,.417],[.763,.478,.447],[.779,.481,.479],[.793,.485,.511],[.805,.49,.543],[.815,.495,.575],[.822,.503,.608],[.828,.511,.639],[.831,.52,.671],[.833,.53,.701],[.833,.542,.73],[.832,.554,.758],[.829,.568,.785],[.825,.582,.81],[.82,.597,.833],[.814,.614,.854],[.807,.63,.873],[.8,.647,.89],[.793,.665,.905],[.786,.683,.918],[.78,.702,.929],[.774,.72,.937],[.768,.738,.944],[.764,.757,.949],[.761,.775,.953],[.759,.792,.954],[.758,.809,.955],[.759,.826,.954],[.761,.842,.953],[.765,.857,.95],[.771,.872,.948],[.779,.886,.945],[.788,.898,.942],[.798,.91,.939],[.81,.922,.937],[.824,.932,.936],[.839,.941,.936],[.855,.95,.937],[.872,.958,.939],[.89,.965,.942],[.908,.972,.948],[.927,.978,.954],[.945,.984,.963],[.964,.989,.974],[.982,.995,.986],[.9999,.9999,.9999]],cubehelix_05:[[0,0,0],[4,1,3],[8,2,7],[12,4,12],[16,5,16],[20,7,20],[24,9,24],[28,10,29],[31,12,33],[35,14,38],[38,16,42],[41,18,47],[44,20,51],[47,22,56],[49,24,61],[52,26,65],[54,28,70],[57,31,75],[59,33,79],[61,36,84],[63,38,88],[65,41,93],[67,43,97],[68,46,101],[70,49,106],[71,52,110],[73,54,114],[74,57,118],[75,60,122],[76,64,126],[77,67,130],[78,70,133],[79,73,137],[80,76,140],[81,80,144],[82,83,147],[83,86,150],[84,90,153],[84,93,156],[85,96,159],[86,100,162],[87,103,164],[88,107,167],[88,110,169],[89,114,171],[90,117,173],[91,121,175],[92,125,177],[93,128,179],[94,132,181],[95,135,182],[96,139,184],[97,142,185],[99,146,186],[100,149,188],[102,152,189],[103,156,190],[105,159,191],[106,163,192],[108,166,193],[110,169,193],[112,172,194],[114,175,195],[116,179,196],[119,182,196],[121,185,197],[124,188,197],[126,191,198],[129,193,199],[132,196,199],[135,199,200],[138,202,201],[141,204,201],[144,207,202],[148,209,203],[151,212,204],[155,214,204],[159,216,205],[162,219,206],[166,221,207],[170,223,209],[174,225,210],[178,227,211],[183,229,213],[187,231,214],[191,233,216],[195,235,218],[200,236,220],[204,238,222],[209,240,224],[213,241,226],[218,243,229],[223,244,232],[227,246,234],[232,247,237],[236,249,240],[241,250,244],[245,252,247],[250,253,251],[255,255,255]],cubehelix_075:[[0,0,0],[4,1,3],[8,2,8],[12,4,12],[16,5,16],[20,7,21],[23,9,25],[26,11,30],[29,13,35],[32,15,40],[35,17,44],[37,19,49],[40,21,54],[42,24,59],[44,26,64],[45,29,69],[47,31,73],[48,34,78],[49,37,83],[51,40,87],[51,43,91],[52,46,96],[53,50,100],[53,53,104],[54,57,107],[54,60,111],[55,64,114],[55,67,118],[55,71,121],[55,75,123],[55,79,126],[55,82,129],[55,86,131],[56,90,133],[56,94,135],[56,98,136],[56,102,138],[57,106,139],[57,110,140],[58,114,141],[58,118,142],[59,122,143],[60,125,143],[61,129,144],[62,133,144],[63,137,144],[65,140,144],[66,144,144],[68,147,144],[70,151,143],[72,154,143],[74,157,143],[77,161,142],[79,164,142],[82,167,142],[85,170,141],[88,173,141],[91,175,140],[95,178,140],[99,180,140],[102,183,140],[106,185,140],[110,188,140],[115,190,140],[119,192,140],[123,194,141],[128,196,142],[132,198,142],[137,200,143],[142,201,144],[147,203,146],[152,205,147],[157,206,149],[161,208,151],[166,209,153],[171,211,155],[176,212,158],[181,213,160],[186,215,163],[191,216,166],[195,218,169],[200,219,173],[204,220,176],[209,222,180],[213,223,184],[217,225,188],[221,226,192],[224,228,197],[228,230,201],[231,232,206],[235,233,211],[238,235,215],[241,237,220],[243,240,225],[246,242,230],[248,244,235],[250,247,240],[252,249,245],[253,252,250],[255,255,255]],cubehelix_1:[[0,0,0],[4,1,3],[8,2,8],[12,4,12],[16,6,17],[19,7,21],[22,9,26],[25,11,31],[28,13,36],[30,16,41],[32,18,46],[34,20,51],[35,23,56],[37,26,61],[38,29,66],[38,32,70],[39,35,75],[40,39,79],[40,42,83],[40,46,87],[40,49,91],[40,53,94],[40,57,97],[39,61,100],[39,65,102],[39,69,105],[38,73,107],[38,77,108],[38,82,110],[38,86,111],[38,90,112],[38,94,112],[38,98,112],[39,103,112],[39,107,112],[40,111,112],[41,115,111],[42,119,110],[44,122,110],[46,126,109],[48,130,107],[50,133,106],[52,136,105],[55,139,103],[58,143,102],[62,145,101],[65,148,99],[69,151,98],[73,153,97],[78,156,96],[83,158,95],[87,160,94],[92,162,94],[98,163,94],[103,165,93],[109,167,94],[114,168,94],[120,169,95],[126,170,96],[132,172,97],[138,173,98],[144,174,100],[150,174,102],[156,175,105],[162,176,107],[168,177,110],[174,178,114],[179,179,117],[185,179,121],[190,180,125],[195,181,129],[200,182,134],[205,183,139],[210,184,144],[214,186,149],[218,187,154],[222,188,159],[226,190,165],[229,192,170],[232,193,175],[235,195,181],[237,197,186],[240,200,192],[242,202,197],[243,204,202],[245,207,208],[246,210,212],[248,213,217],[249,216,222],[249,219,226],[250,222,230],[251,225,234],[251,229,238],[252,232,241],[252,236,244],[252,239,247],[253,243,249],[253,247,251],[254,251,253],[255,255,255]],cubehelix_15:[[0,0,0],[4,1,4],[8,2,8],[11,4,13],[15,6,17],[18,8,23],[20,10,28],[22,12,33],[24,15,38],[25,18,43],[26,21,48],[26,24,53],[26,28,57],[26,31,61],[26,35,65],[25,39,68],[24,43,71],[24,48,73],[23,52,75],[22,57,77],[21,61,78],[21,66,78],[21,70,78],[20,75,77],[21,79,76],[21,83,75],[22,88,73],[24,92,71],[26,95,69],[28,99,67],[31,102,64],[34,105,62],[38,108,59],[43,111,57],[48,113,54],[53,115,52],[59,117,50],[65,118,49],[72,120,47],[79,121,47],[86,121,46],[94,122,47],[102,122,47],[110,122,49],[118,122,51],[125,122,53],[133,122,57],[141,121,60],[149,121,65],[156,121,70],[163,121,75],[170,120,81],[176,120,88],[182,120,95],[187,121,102],[192,121,110],[196,122,118],[200,123,126],[204,124,135],[206,125,143],[208,127,151],[210,129,159],[211,131,168],[212,134,175],[212,137,183],[212,140,190],[211,143,197],[210,147,204],[209,151,210],[207,155,216],[206,159,221],[204,163,225],[202,168,229],[200,173,233],[199,177,236],[197,182,238],[196,187,240],[195,191,241],[194,196,242],[193,201,243],[193,205,243],[193,209,243],[194,214,243],[194,218,242],[196,221,241],[198,225,241],[200,228,240],[203,231,239],[206,234,239],[209,237,238],[213,239,238],[217,242,238],[222,244,239],[226,246,240],[231,247,241],[236,249,243],[240,250,245],[245,252,248],[250,253,251],[255,255,255]],cubehelix_25:[[0,0,0],[4,1,4],[7,3,8],[10,4,13],[13,7,19],[14,9,24],[15,12,29],[15,16,34],[15,19,38],[14,23,42],[13,28,45],[12,32,47],[11,37,48],[10,42,48],[9,47,47],[9,51,46],[10,56,43],[11,60,40],[14,64,37],[17,67,33],[21,70,30],[27,72,26],[33,74,23],[41,75,20],[49,76,18],[58,76,18],[67,75,18],[77,74,19],[87,73,22],[97,72,26],[106,70,32],[115,69,39],[123,67,47],[130,66,57],[136,66,67],[141,66,78],[145,66,89],[147,67,101],[148,69,113],[147,71,125],[146,74,136],[142,78,147],[138,83,156],[133,88,164],[128,94,171],[121,101,177],[115,108,181],[109,115,183],[103,122,183],[97,130,182],[92,137,180],[88,144,176],[85,151,171],[84,157,166],[84,163,159],[85,168,152],[88,172,145],[92,176,138],[98,178,131],[104,180,125],[112,182,119],[121,182,115],[131,182,112],[142,182,110],[152,181,110],[163,179,111],[174,178,114],[184,176,118],[194,175,123],[203,173,130],[211,172,138],[218,171,147],[224,171,156],[229,171,166],[232,171,176],[234,173,186],[236,175,196],[236,177,205],[235,180,214],[234,184,222],[232,188,229],[229,192,235],[227,197,240],[224,202,244],[222,207,247],[220,212,249],[218,217,250],[217,222,250],[217,227,250],[217,231,249],[218,235,248],[221,238,247],[223,241,246],[227,244,245],[231,246,245],[235,248,245],[240,250,246],[245,252,248],[250,253,251],[255,255,255]],singlehue:[[247,251,255],[222,235,247],[198,219,239],[158,202,225],[107,174,214],[66,146,198],[33,113,181],[8,81,156],[8,48,107]].reverse(),bodyheat:[[0,0,0,0],[178,34,34,.39],[227,105,5,.58],[238,210,20,.84],[255,255,255,1]],extendedBlackBody:[[0,0,0,0],[0,24,168,.22],[99,0,228,.35],[220,20,60,.47],[255,117,56,.65],[238,210,20,.84],[255,255,255,1]],kindlmann:[[0,0,0],[46,4,76],[63,7,145],[8,66,165],[5,106,106],[7,137,69],[8,168,26],[84,194,9],[196,206,10],[252,220,197],[255,255,255]],spectralFull:[[158,1,66],[213,62,79],[244,109,67],[253,174,97],[254,224,139],[255,255,191],[230,245,152],[171,221,164],[102,194,165],[50,136,189],[94,79,162]].reverse(),coolwarmMoreland:[[59,76,192],[68,90,204],[77,104,215],[87,117,225],[98,130,234],[108,142,241],[119,154,247],[130,165,251],[141,176,254],[152,185,255],[163,194,255],[174,201,253],[184,208,249],[194,213,244],[204,217,238],[213,219,230],[221,221,221],[229,216,209],[236,211,197],[241,204,185],[245,196,173],[247,187,160],[247,177,148],[247,166,135],[244,154,123],[241,141,111],[236,127,99],[229,112,88],[222,96,77],[213,80,66],[203,62,56],[192,40,47],[180,4,38]],blueyellow:[[13,0,252],[190,190,190],[252,252,0]],rainbowhcl:function(t){t=1-t,t*=.9,t-=.15;var e=d3.hcl(360*t,100,55),r=d3.rgb(e);return r.r=Math.max(0,Math.min(255,r.r)),r.g=Math.max(0,Math.min(255,r.g)),r.b=Math.max(0,Math.min(255,r.b)),r},rainbowhcl100:function(t){t=1-t,t*=.9,t-=.15;var e=d3.hcl(360*t,50,100),r=d3.rgb(e);return r.r=Math.max(0,Math.min(255,r.r)),r.g=Math.max(0,Math.min(255,r.g)),r.b=Math.max(0,Math.min(255,r.b)),r},rainbowhcl80:function(t){t=1-t,t*=.9,t-=.15;var e=d3.hcl(360*t,70,80),r=d3.rgb(e);return r.r=Math.max(0,Math.min(255,r.r)),r.g=Math.max(0,Math.min(255,r.g)),r.b=Math.max(0,Math.min(255,r.b)),r},rainbowhcl90:function(t){t=1-t,t*=.9,t-=.15;var e=d3.hcl(360*t,70,90),r=d3.rgb(e);return r.r=Math.max(0,Math.min(255,r.r)),r.g=Math.max(0,Math.min(255,r.g)),r.b=Math.max(0,Math.min(255,r.b)),r},d3rainbow:function(t){return t=1-t,t*=.9,d3.rgb(d3.interpolateRainbow(t))},d3sinebow:function(t){return t=1-t,t*=.9,t-=.25,d3.rgb(d3.interpolateSinebow(t))},viridis:function(){for(var t=[],e=0;e<=100;e++){var r=d3.interpolateViridis(e/100),o=d3.color(r);t.push([o.r,o.g,o.b])}return t}(),plasma:function(){for(var t=[],e=0;e<=100;e++){var r=d3.interpolatePlasma(e/100),o=d3.color(r);t.push([o.r,o.g,o.b])}return t}(),inferno:function(){for(var t=[],e=0;e<=100;e++){var r=d3.interpolateInferno(e/100),o=d3.color(r);t.push([o.r,o.g,o.b])}return t}(),plasmaShort:function(){for(var t=[],e=0;e<=100;e++){var r=e/100*.9+.1,o=d3.interpolatePlasma(r),a=d3.color(o);t.push([a.r,a.g,a.b])}return t}(),redpurple:[[255,247,243],[253,224,221],[252,197,192],[250,159,181],[247,104,161],[221,52,151],[174,1,126],[122,1,119],[73,0,106]].reverse(),greyred:[[178,24,43],[214,96,77],[244,165,130],[253,219,199],[255,255,255],[224,224,224],[186,186,186],[135,135,135],[77,77,77]].reverse(),coolwarm:[[63,0,242],[83,41,240],[121,98,245],[169,158,249],[225,223,252],[244,208,209],[232,135,135],[221,70,73],[221,25,29]],reds:[[226,202,100],[225,180,87],[225,159,79],[227,140,75],[219,118,71],[205,95,67],[191,73,63],[169,50,57],[147,27,51]].reverse(),purples:[[59,27,80],[79,37,94],[95,52,108],[112,68,123],[135,84,140],[160,101,157],[186,116,169],[206,131,176],[215,146,171]],blues:[[253,244,249],[214,207,230],[169,180,214],[122,158,201],[76,133,184],[49,107,174],[39,82,149],[27,61,103],[18,41,70]].reverse(),spectral:[[213,62,79],[244,109,67],[253,174,97],[254,224,139],[255,255,191],[230,245,152],[171,221,164],[102,194,165],[50,136,189]].reverse(),turbo:[[48,18,59],[50,21,67],[51,24,74],[52,27,81],[53,30,88],[54,33,95],[55,36,102],[56,39,109],[57,42,115],[58,45,121],[59,47,128],[60,50,134],[61,53,139],[62,56,145],[63,59,151],[63,62,156],[64,64,162],[65,67,167],[65,70,172],[66,73,177],[66,75,181],[67,78,186],[68,81,191],[68,84,195],[68,86,199],[69,89,203],[69,92,207],[69,94,211],[70,97,214],[70,100,218],[70,102,221],[70,105,224],[70,107,227],[71,110,230],[71,113,233],[71,115,235],[71,118,238],[71,120,240],[71,123,242],[70,125,244],[70,128,246],[70,130,248],[70,133,250],[70,135,251],[69,138,252],[69,140,253],[68,143,254],[67,145,254],[66,148,255],[65,150,255],[64,153,255],[62,155,254],[61,158,254],[59,160,253],[58,163,252],[56,165,251],[55,168,250],[53,171,248],[51,173,247],[49,175,245],[47,178,244],[46,180,242],[44,183,240],[42,185,238],[40,188,235],[39,190,233],[37,192,231],[35,195,228],[34,197,226],[32,199,223],[31,201,221],[30,203,218],[28,205,216],[27,208,213],[26,210,210],[26,212,208],[25,213,205],[24,215,202],[24,217,200],[24,219,197],[24,221,194],[24,222,192],[24,224,189],[25,226,187],[25,227,185],[26,228,182],[28,230,180],[29,231,178],[31,233,175],[32,234,172],[34,235,170],[37,236,167],[39,238,164],[42,239,161],[44,240,158],[47,241,155],[50,242,152],[53,243,148],[56,244,145],[60,245,142],[63,246,138],[67,247,135],[70,248,132],[74,248,128],[78,249,125],[82,250,122],[85,250,118],[89,251,115],[93,252,111],[97,252,108],[101,253,105],[105,253,102],[109,254,98],[113,254,95],[117,254,92],[121,254,89],[125,255,86],[128,255,83],[132,255,81],[136,255,78],[139,255,75],[143,255,73],[146,255,71],[150,254,68],[153,254,66],[156,254,64],[159,253,63],[161,253,61],[164,252,60],[167,252,58],[169,251,57],[172,251,56],[175,250,55],[177,249,54],[180,248,54],[183,247,53],[185,246,53],[188,245,52],[190,244,52],[193,243,52],[195,241,52],[198,240,52],[200,239,52],[203,237,52],[205,236,52],[208,234,52],[210,233,53],[212,231,53],[215,229,53],[217,228,54],[219,226,54],[221,224,55],[223,223,55],[225,221,55],[227,219,56],[229,217,56],[231,215,57],[233,213,57],[235,211,57],[236,209,58],[238,207,58],[239,205,58],[241,203,58],[242,201,58],[244,199,58],[245,197,58],[246,195,58],[247,193,58],[248,190,57],[249,188,57],[250,186,57],[251,184,56],[251,182,55],[252,179,54],[252,177,54],[253,174,53],[253,172,52],[254,169,51],[254,167,50],[254,164,49],[254,161,48],[254,158,47],[254,155,45],[254,153,44],[254,150,43],[254,147,42],[254,144,41],[253,141,39],[253,138,38],[252,135,37],[252,132,35],[251,129,34],[251,126,33],[250,123,31],[249,120,30],[249,117,29],[248,114,28],[247,111,26],[246,108,25],[245,105,24],[244,102,23],[243,99,21],[242,96,20],[241,93,19],[240,91,18],[239,88,17],[237,85,16],[236,83,15],[235,80,14],[234,78,13],[232,75,12],[231,73,12],[229,71,11],[228,69,10],[226,67,10],[225,65,9],[223,63,8],[221,61,8],[220,59,7],[218,57,7],[216,55,6],[214,53,6],[212,51,5],[210,49,5],[208,47,5],[206,45,4],[204,43,4],[202,42,4],[200,40,3],[197,38,3],[195,37,3],[193,35,2],[190,33,2],[188,32,2],[185,30,2],[183,29,2],[180,27,1],[178,26,1],[175,24,1],[172,23,1],[169,22,1],[167,20,1],[164,19,1],[161,18,1],[158,16,1],[155,15,1],[152,14,1],[149,13,1],[146,11,1],[142,10,1],[139,9,2],[136,8,2],[133,7,2],[129,6,2],[126,5,2],[122,4,3]],mellowrainbow:[{x:"0",o:"1",r:"1",g:"0.988235",b:"0.968627"},{x:"0.025",o:"1",r:"1",g:"0.960784",b:"0.870588"},{x:"0.05",o:"1",r:"0.968627",g:"0.921569",b:"0.764706"},{x:"0.075",o:"1",r:"0.960784",g:"0.913725",b:"0.670588"},{x:"0.1",o:"1",r:"0.941176",g:"0.905882",b:"0.6"},{x:"0.125",o:"1",r:"0.929412",g:"0.917647",b:"0.541176"},{x:"0.15",o:"1",r:"0.898039",g:"0.909804",b:"0.501961"},{x:"0.175",o:"1",r:"0.847059",g:"0.890196",b:"0.462745"},{x:"0.2",o:"1",r:"0.772549",g:"0.858824",b:"0.431373"},{x:"0.225",o:"1",r:"0.686275",g:"0.831373",b:"0.4"},{x:"0.25",o:"1",r:"0.603922",g:"0.8",b:"0.368627"},{x:"0.275",o:"1",r:"0.517647",g:"0.768627",b:"0.337255"},{x:"0.3",o:"1",r:"0.415686",g:"0.721569",b:"0.301961"},{x:"0.325",o:"1",r:"0.32549",g:"0.678431",b:"0.270588"},{x:"0.35",o:"1",r:"0.247059",g:"0.65098",b:"0.247059"},{x:"0.375",o:"1",r:"0.219608",g:"0.611765",b:"0.266667"},{x:"0.4",o:"1",r:"0.192157",g:"0.580392",b:"0.282353"},{x:"0.425",o:"1",r:"0.156863",g:"0.560784",b:"0.290196"},{x:"0.45",o:"1",r:"0.117647",g:"0.541176",b:"0.294118"},{x:"0.475",o:"1",r:"0.090196",g:"0.521569",b:"0.305882"},{x:"0.5",o:"1",r:"0.070588",g:"0.509804",b:"0.32549"},{x:"0.525",o:"1",r:"0.082353",g:"0.509804",b:"0.368627"},{x:"0.55",o:"1",r:"0.090196",g:"0.521569",b:"0.411765"},{x:"0.575",o:"1",r:"0.094118",g:"0.529412",b:"0.458824"},{x:"0.6",o:"1",r:"0.101961",g:"0.541176",b:"0.501961"},{x:"0.625",o:"1",r:"0.113725",g:"0.54902",b:"0.54902"},{x:"0.65",o:"1",r:"0.129412",g:"0.529412",b:"0.560784"},{x:"0.675",o:"1",r:"0.145098",g:"0.521569",b:"0.580392"},{x:"0.7",o:"1",r:"0.156863",g:"0.498039",b:"0.6"},{x:"0.725",o:"1",r:"0.164706",g:"0.447059",b:"0.611765"},{x:"0.75",o:"1",r:"0.172549",g:"0.396078",b:"0.619608"},{x:"0.775",o:"1",r:"0.176471",g:"0.341176",b:"0.631373"},{x:"0.8",o:"1",r:"0.184314",g:"0.313725",b:"0.639216"},{x:"0.825",o:"1",r:"0.184314",g:"0.27451",b:"0.619608"},{x:"0.85",o:"1",r:"0.184314",g:"0.235294",b:"0.6"},{x:"0.875",o:"1",r:"0.184314",g:"0.2",b:"0.580392"},{x:"0.9",o:"1",r:"0.215686",g:"0.196078",b:"0.560784"},{x:"0.925",o:"1",r:"0.235294",g:"0.192157",b:"0.509804"},{x:"0.95",o:"1",r:"0.262745",g:"0.2",b:"0.478431"},{x:"0.975",o:"1",r:"0.286275",g:"0.219608",b:"0.439216"},{x:"1",o:"1",r:"0.301961",g:"0.239216",b:"0.4"}].reverse(),bluegreen:[{x:"0",o:"1",r:"0.984314",g:"0.988235",b:"0.94902"},{x:"0.05",o:"1",r:"0.92549",g:"0.960784",b:"0.827451"},{x:"0.1",o:"1",r:"0.858824",g:"0.94902",b:"0.741176"},{x:"0.15",o:"1",r:"0.792157",g:"0.941176",b:"0.694118"},{x:"0.2",o:"1",r:"0.682353",g:"0.929412",b:"0.631373"},{x:"0.25",o:"1",r:"0.588235",g:"0.921569",b:"0.611765"},{x:"0.275",o:"1",r:"0.560784",g:"0.921569",b:"0.619608"},{x:"0.3",o:"1",r:"0.541176",g:"0.929412",b:"0.643137"},{x:"0.325",o:"1",r:"0.517647",g:"0.941176",b:"0.670588"},{x:"0.35",o:"1",r:"0.494118",g:"0.94902",b:"0.705882"},{x:"0.375",o:"1",r:"0.47451",g:"0.929412",b:"0.72549"},{x:"0.4",o:"1",r:"0.458824",g:"0.921569",b:"0.752941"},{x:"0.425",o:"1",r:"0.431373",g:"0.901961",b:"0.784314"},{x:"0.45",o:"1",r:"0.403922",g:"0.901961",b:"0.815686"},{x:"0.475",o:"1",r:"0.384314",g:"0.890196",b:"0.847059"},{x:"0.5",o:"1",r:"0.352941",g:"0.878431",b:"0.878431"},{x:"0.55",o:"1",r:"0.329412",g:"0.807843",b:"0.870588"},{x:"0.6",o:"1",r:"0.290196",g:"0.709804",b:"0.85098"},{x:"0.65",o:"1",r:"0.25098",g:"0.623529",b:"0.839216"},{x:"0.7",o:"1",r:"0.227451",g:"0.545098",b:"0.878431"},{x:"0.75",o:"1",r:"0.235294",g:"0.478431",b:"0.839216"},{x:"0.8",o:"1",r:"0.243137",g:"0.419608",b:"0.780392"},{x:"0.85",o:"1",r:"0.25098",g:"0.388235",b:"0.741176"},{x:"0.875",o:"1",r:"0.27451",g:"0.380392",b:"0.701961"},{x:"0.9",o:"1",r:"0.298039",g:"0.380392",b:"0.65098"},{x:"0.95",o:"1",r:"0.298039",g:"0.352941",b:"0.568627"},{x:"1",o:"1",r:"0.278431",g:"0.305882",b:"0.45098"}].reverse(),fiveMellowWave:[{x:"0",o:"1",r:"0.984313725490196",g:"0.964705882352941",b:"0.737254901960784"},{x:"0.0206315793981833",o:"1",r:"0.968627450980392",g:"0.929411764705882",b:"0.635294117647059"},{x:"0.0412631587963664",o:"1",r:"0.956862745098039",g:"0.901960784313726",b:"0.549019607843137"},{x:"0.0618947381945497",o:"1",r:"0.945098039215686",g:"0.866666666666667",b:"0.466666666666667"},{x:"0.0825263175927329",o:"1",r:"0.925490196078431",g:"0.831372549019608",b:"0.403921568627451"},{x:"0.103157896990916",o:"1",r:"0.909803921568627",g:"0.8",b:"0.368627450980392"},{x:"0.123789476389099",o:"1",r:"0.894117647058824",g:"0.768627450980392",b:"0.337254901960784"},{x:"0.144421055787283",o:"1",r:"0.87843137254902",g:"0.733333333333333",b:"0.309803921568627"},{x:"0.172792568802834",o:"1",r:"0.819846890261985",g:"0.661246947971898",b:"0.291535442288565"},{x:"0.188001692295074",o:"1",r:"0.764705882352941",g:"0.596078431372549",b:"0.254901960784314"},{x:"0.205745667219162",o:"1",r:"0.611764705882353",g:"0.419607843137255",b:"0.27843137254902"},{x:"0.214195191860199",o:"1",r:"0.56078431372549",g:"0.36078431372549",b:"0.247058823529412"},{x:"0.241656109690666",o:"1",r:"0.588235294117647",g:"0.396078431372549",b:"0.266666666666667"},{x:"0.26404732465744",o:"1",r:"0.638419246134512",g:"0.451860266059187",b:"0.308394652206041"},{x:"0.314744412899017",o:"1",r:"0.8",g:"0.635294117647059",b:"0.447058823529412"},{x:"0.333755820989609",o:"1",r:"0.854901960784314",g:"0.709803921568627",b:"0.505882352941176"},{x:"0.355724543333054",o:"1",r:"0.909803921568627",g:"0.788235294117647",b:"0.592156862745098"},{x:"0.374313473701477",o:"1",r:"0.929411764705882",g:"0.831372549019608",b:"0.670588235294118"},{x:"0.386987745761871",o:"1",r:"0.949019607843137",g:"0.882352941176471",b:"0.772549019607843"},{x:"0.399239540100098",o:"1",r:"0.886275",g:"0.921569",b:"0.854902"},{x:"0.426700472831726",o:"1",r:"0.741176",g:"0.788235",b:"0.717647"},{x:"0.44317701458931",o:"1",r:"0.662745",g:"0.729412",b:"0.65098"},{x:"0.449438721180243",o:"1",r:"0.639216",g:"0.709804",b:"0.631373"},{x:"0.459711895186179",o:"1",r:"0.607843",g:"0.690196",b:"0.607843"},{x:"0.469985069192115",o:"1",r:"0.588235",g:"0.670588",b:"0.596078"},{x:"0.48025824319805",o:"1",r:"0.564706",g:"0.65098",b:"0.580392"},{x:"0.490531417203985",o:"1",r:"0.54902",g:"0.631373",b:"0.568627"},{x:"0.500804591209921",o:"1",r:"0.52549",g:"0.611765",b:"0.552941"},{x:"0.511077765215856",o:"1",r:"0.505882",g:"0.588235",b:"0.541176"},{x:"0.521350939221792",o:"1",r:"0.486275",g:"0.568627",b:"0.52549"},{x:"0.531624113227727",o:"1",r:"0.466667",g:"0.54902",b:"0.513725"},{x:"0.541897287233663",o:"1",r:"0.447059",g:"0.529412",b:"0.501961"},{x:"0.552170461239598",o:"1",r:"0.427451",g:"0.509804",b:"0.490196"},{x:"0.562443635245534",o:"1",r:"0.407843",g:"0.490196",b:"0.47451"},{x:"0.572716809251469",o:"1",r:"0.380392",g:"0.458824",b:"0.454902"},{x:"0.582989983257404",o:"1",r:"0.356863",g:"0.431373",b:"0.431373"},{x:"0.593155920505524",o:"1",r:"0.33756567123389",g:"0.409324037046617",b:"0.409317991422805"},{x:"0.61339865781734",o:"1",r:"0.305882352941176",g:"0.384313725490196",b:"0.490196078431373"},{x:"0.633523952055547",o:"1",r:"0.36078431372549",g:"0.443137254901961",b:"0.552941176470588"},{x:"0.653649246293753",o:"1",r:"0.415686274509804",g:"0.505882352941176",b:"0.615686274509804"},{x:"0.67377454053196",o:"1",r:"0.474509803921569",g:"0.568627450980392",b:"0.67843137254902"},{x:"0.693899834770166",o:"1",r:"0.537254901960784",g:"0.635294117647059",b:"0.745098039215686"},{x:"0.714025129008373",o:"1",r:"0.607843137254902",g:"0.705882352941177",b:"0.803921568627451"},{x:"0.73415042324658",o:"1",r:"0.67843137254902",g:"0.776470588235294",b:"0.862745098039216"},{x:"0.749894380569458",o:"1",r:"0.741176470588235",g:"0.83921568627451",b:"0.913725490196078"},{x:"0.76932829618454",o:"1",r:"0.815686274509804",g:"0.905882352941176",b:"0.96078431372549"},{x:"0.789607107639313",o:"1",r:"0.882352941176471",g:"0.949019607843137",b:"0.984313725490196"},{x:"0.806083679199219",o:"1",r:"0.825984561703371",g:"0.955751296838809",b:"0.925740559542068"},{x:"0.822137713432312",o:"1",r:"0.701961",g:"0.901961",b:"0.858824"},{x:"0.841994106769562",o:"1",r:"0.560784",g:"0.8",b:"0.764706"},{x:"0.857625722885132",o:"1",r:"0.466667",g:"0.74902",b:"0.729412"},{x:"0.876721907366196",o:"1",r:"0.352941",g:"0.65098",b:"0.65098"},{x:"0.897268256138496",o:"1",r:"0.266667",g:"0.545098",b:"0.568627"},{x:"0.917814604910797",o:"1",r:"0.196078",g:"0.454902",b:"0.490196"},{x:"0.938360953683098",o:"1",r:"0.133333",g:"0.376471",b:"0.419608"},{x:"0.958907302455399",o:"1",r:"0.094118",g:"0.329412",b:"0.380392"},{x:"0.979453651227699",o:"1",r:"0.047059",g:"0.262745",b:"0.321569"},{x:"1",o:"1",r:"0",g:"0.188235",b:"0.25098"}].reverse(),blueorange:[{v:"0",o:"1",r:"0.0862745098039216",g:"0.00392156862745098",b:"0.298039215686275"},{v:"0.030334",o:"1",r:"0.113725",g:"0.0235294",b:"0.45098"},{v:"0.055527",o:"1",r:"0.105882",g:"0.0509804",b:"0.509804"},{v:"0.073008",o:"1",r:"0.0392157",g:"0.0392157",b:"0.560784"},{v:"0.089974",o:"1",r:"0.0313725",g:"0.0980392",b:"0.6"},{v:"0.106427",o:"1",r:"0.0431373",g:"0.164706",b:"0.639216"},{v:"0.130077",o:"1",r:"0.054902",g:"0.243137",b:"0.678431"},{v:"0.16144",o:"1",r:"0.054902",g:"0.317647",b:"0.709804"},{v:"0.2",o:"1",r:"0.0509804",g:"0.396078",b:"0.741176"},{v:"0.225",o:"1",r:"0.0392157",g:"0.466667",b:"0.768627"},{v:"0.25",o:"1",r:"0.0313725",g:"0.537255",b:"0.788235"},{v:"0.276093",o:"1",r:"0.0313725",g:"0.615686",b:"0.811765"},{v:"0.302828",o:"1",r:"0.0235294",g:"0.709804",b:"0.831373"},{v:"0.329563",o:"1",r:"0.0509804",g:"0.8",b:"0.85098"},{v:"0.351671",o:"1",r:"0.0705882",g:"0.854902",b:"0.870588"},{v:"0.372237",o:"1",r:"0.262745",g:"0.901961",b:"0.862745"},{v:"0.390231",o:"1",r:"0.423529",g:"0.941176",b:"0.87451"},{v:"0.417995",o:"1",r:"0.572549",g:"0.964706",b:"0.835294"},{v:"0.436504",o:"1",r:"0.658824",g:"0.980392",b:"0.843137"},{v:"0.456041",o:"1",r:"0.764706",g:"0.980392",b:"0.866667"},{v:"0.468895",o:"1",r:"0.827451",g:"0.980392",b:"0.886275"},{v:"0.482262",o:"1",r:"0.890196078431372",g:"0.988235294117647",b:"0.925490196078431"},{v:"0.492545",o:"1",r:"0.913725",g:"0.988235",b:"0.937255"},{v:"0.501285",o:"1",r:"1",g:"1",b:"0.972549019607843"},{v:"0.510026",o:"1",r:"0.988235294117647",g:"0.988235294117647",b:"0.905882352941176"},{v:"0.526478",o:"1",r:"0.992156862745098",g:"0.972549019607843",b:"0.803921568627451"},{v:"0.539846",o:"1",r:"0.992157",g:"0.964706",b:"0.713725"},{v:"0.554756",o:"1",r:"0.988235",g:"0.956863",b:"0.643137"},{v:"0.576864",o:"1",r:"0.980392",g:"0.917647",b:"0.509804"},{v:"0.599486",o:"1",r:"0.968627",g:"0.87451",b:"0.407843"},{v:"0.620051",o:"1",r:"0.94902",g:"0.823529",b:"0.321569"},{v:"0.636504",o:"1",r:"0.929412",g:"0.776471",b:"0.278431"},{v:"0.660668",o:"1",r:"0.909804",g:"0.717647",b:"0.235294"},{v:"0.682262",o:"1",r:"0.890196",g:"0.658824",b:"0.196078"},{v:"0.7",o:"1",r:"0.878431",g:"0.619608",b:"0.168627"},{v:"0.725",o:"1",r:"0.870588",g:"0.54902",b:"0.156863"},{v:"0.75",o:"1",r:"0.85098",g:"0.47451",b:"0.145098"},{v:"0.775",o:"1",r:"0.831373",g:"0.411765",b:"0.133333"},{v:"0.8",o:"1",r:"0.811765",g:"0.345098",b:"0.113725"},{v:"0.825",o:"1",r:"0.788235",g:"0.266667",b:"0.0941176"},{v:"0.85",o:"1",r:"0.741176",g:"0.184314",b:"0.0745098"},{v:"0.875",o:"1",r:"0.690196",g:"0.12549",b:"0.0627451"},{v:"0.9",o:"1",r:"0.619608",g:"0.0627451",b:"0.0431373"},{v:"0.923393",o:"1",r:"0.54902",g:"0.027451",b:"0.0705882"},{v:"0.943959",o:"1",r:"0.470588",g:"0.0156863",b:"0.0901961"},{v:"0.967095",o:"1",r:"0.4",g:"0.00392157",b:"0.101961"},{v:"1",o:"1",r:"0.188235294117647",g:"0",b:"0.0705882352941176"}],threewave:[{x:"0",o:"1",r:"0.7490196078431373",g:"0.9058823529411765",b:"0.9333333333333333"},{x:"0",o:"1",r:"0.7490196078431373",g:"0.9058823529411765",b:"0.9333333333333333"},{x:"0.015698778629302978",o:"1",r:"0.6352941176470588",g:"0.8235294117647058",b:"0.8705882352941177"},{x:"0.031397557258605956",o:"1",r:"0.5764705882352941",g:"0.7686274509803922",b:"0.8352941176470589"},{x:"0.06279511451721191",o:"1",r:"0.4823529411764706",g:"0.6666666666666666",b:"0.7647058823529411"},{x:"0.09419267177581787",o:"1",r:"0.403921568627451",g:"0.5647058823529412",b:"0.6941176470588235"},{x:"0.12559022903442382",o:"1",r:"0.3333333333333333",g:"0.47058823529411764",b:"0.6235294117647059"},{x:"0.15698778629302979",o:"1",r:"0.27450980392156865",g:"0.39215686274509803",b:"0.5568627450980392"},{x:"0.18838534355163575",o:"1",r:"0.2196078431372549",g:"0.30980392156862746",b:"0.47843137254901963"},{x:"0.21978290081024168",o:"1",r:"0.1568627450980392",g:"0.2235294117647059",b:"0.3843137254901961"},{x:"0.25118045806884765",o:"1",r:"0.10980392156862745",g:"0.1568627450980392",b:"0.3058823529411765"},{x:"0.28257801532745364",o:"1",r:"0.06274509803921569",g:"0.07450980392156863",b:"0.19215686274509805"},{x:"0.3139855725860596",o:"1",r:"0.054902",g:"0.109804",b:"0.121569"},{x:"0.3320312050611973",o:"1",r:"0.07450980392156863",g:"0.16862745098039217",b:"0.17647058823529413"},{x:"0.350076837536335",o:"1",r:"0.08627450980392157",g:"0.2235294117647059",b:"0.21568627450980393"},{x:"0.3681224700114727",o:"1",r:"0.09411764705882353",g:"0.27058823529411763",b:"0.24313725490196078"},{x:"0.38616810248661043",o:"1",r:"0.10588235294117647",g:"0.32941176470588235",b:"0.27058823529411763"},{x:"0.4042137349617481",o:"1",r:"0.11372549019607843",g:"0.3843137254901961",b:"0.2784313725490196"},{x:"0.42225936743688586",o:"1",r:"0.11764705882352941",g:"0.43137254901960786",b:"0.27450980392156865"},{x:"0.44030499991202354",o:"1",r:"0.11764705882352941",g:"0.4745098039215686",b:"0.2549019607843137"},{x:"0.4583506323871612",o:"1",r:"0.11764705882352941",g:"0.5058823529411764",b:"0.2235294117647059"},{x:"0.47639626486229897",o:"1",r:"0.11372549019607843",g:"0.5333333333333333",b:"0.1843137254901961"},{x:"0.4944418973374367",o:"1",r:"0.10196078431372549",g:"0.5647058823529412",b:"0.12941176470588237"},{x:"0.5124875298125744",o:"1",r:"0.09019607843137255",g:"0.6",b:"0.07450980392156863"},{x:"0.5305331622877121",o:"1",r:"0.13725490196078433",g:"0.6431372549019608",b:"0.058823529411764705"},{x:"0.5485787947628498",o:"1",r:"0.23137254901960785",g:"0.6862745098039216",b:"0.08627450980392157"},{x:"0.5666244272379876",o:"1",r:"0.3333333333333333",g:"0.7254901960784313",b:"0.11764705882352941"},{x:"0.5846700597131252",o:"1",r:"0.4392156862745098",g:"0.7607843137254902",b:"0.16470588235294117"},{x:"0.6027156921882629",o:"1",r:"0.5568627450980392",g:"0.8",b:"0.23921568627450981"},{x:"0.6207613246634006",o:"1",r:"0.6588235294117647",g:"0.8352941176470589",b:"0.2901960784313726"},{x:"0.6388069571385384",o:"1",r:"0.7686274509803922",g:"0.8745098039215686",b:"0.3803921568627451"},{x:"0.6568525896136761",o:"1",r:"0.8666666666666667",g:"0.9137254901960784",b:"0.5058823529411764"},{x:"0.6748982220888138",o:"1",r:"0.9411764705882353",g:"0.9411764705882353",b:"0.6352941176470588"},{x:"0.6749082220888137",o:"1",r:"0.984313725490196",g:"0.9764705882352941",b:"0.6941176470588235"},{x:"0.6749082220888137",o:"1",r:"0.984313725490196",g:"0.9764705882352941",b:"0.6941176470588235"},{x:"0.6755584056446361",o:"1",r:"0.984313725490196",g:"0.9764705882352941",b:"0.6901960784313725"},{x:"0.691162810984373",o:"1",r:"0.9803921568627451",g:"0.9568627450980393",b:"0.6235294117647059"},{x:"0.7074173998799324",o:"1",r:"0.9764705882352941",g:"0.9333333333333333",b:"0.5490196078431373"},{x:"0.7236719887754917",o:"1",r:"0.9686274509803922",g:"0.8980392156862745",b:"0.47058823529411764"},{x:"0.739926577671051",o:"1",r:"0.9686274509803922",g:"0.8588235294117647",b:"0.3843137254901961"},{x:"0.7561811665666103",o:"1",r:"0.9607843137254902",g:"0.807843137254902",b:"0.29411764705882354"},{x:"0.7724357554621696",o:"1",r:"0.9529411764705882",g:"0.7529411764705882",b:"0.23529411764705882"},{x:"0.7886903443577289",o:"1",r:"0.9450980392156862",g:"0.7019607843137254",b:"0.17254901960784313"},{x:"0.8049449332532882",o:"1",r:"0.9333333333333333",g:"0.6431372549019608",b:"0.12156862745098039"},{x:"0.8211995221488475",o:"1",r:"0.9254901960784314",g:"0.5843137254901961",b:"0.0784313725490196"},{x:"0.8374541110444068",o:"1",r:"0.9176470588235294",g:"0.5294117647058824",b:"0.050980392156862744"},{x:"0.8537086999399661",o:"1",r:"0.9058823529411765",g:"0.4745098039215686",b:"0.03137254901960784"},{x:"0.8699632888355254",o:"1",r:"0.8901960784313725",g:"0.40784313725490196",b:"0.0196078431372549"},{x:"0.8862178777310847",o:"1",r:"0.807843137254902",g:"0.3176470588235294",b:"0"},{x:"0.902472466626644",o:"1",r:"0.7686274509803922",g:"0.2549019607843137",b:"0"},{x:"0.9187270555222034",o:"1",r:"0.7098039215686275",g:"0.2",b:"0.00784313725490196"},{x:"0.9349816444177628",o:"1",r:"0.6392156862745098",g:"0.15294117647058825",b:"0.0196078431372549"},{x:"0.951236233313322",o:"1",r:"0.5607843137254902",g:"0.09803921568627451",b:"0.027450980392156862"},{x:"0.9674908222088814",o:"1",r:"0.4745098039215686",g:"0.050980392156862744",b:"0.0392156862745098"},{x:"0.9837454111044406",o:"1",r:"0.38823529411764707",g:"0.0392156862745098",b:"0.06274509803921569"}]};function isFunction(t){return!!(t&&t.constructor&&t.call&&t.apply)}var loaded_colormaps={};function getColorPreset(t,e,r,o){null!=e&&null!=r||(e=0,r=1);var a=r-e,i=COLOR_PRESETS[t],n=null;if(t.indexOf("cie")>0||"greyscale"==t?n="lab":"blueyellow"==t&&(n="hsl"),i){var s=[],l=!1;if(Array.isArray(i)){s=[];for(var c=0,h=i.length;c<h;c++){var u=a*(c/(h-1)),d=i[c];if(Array.isArray(d))d[0]%1!=0&&(d[0]=Math.min(255,Math.floor(.5+255*d[0]))),d[1]%1!=0&&(d[1]=Math.min(255,Math.floor(.5+255*d[1]))),d[2]%1!=0&&(d[2]=Math.min(255,Math.floor(.5+255*d[2]))),s.push({value:d.length>3?d[3]:u,rgb:[d[0],d[1],d[2]]});else if("string"==typeof d){var p=d3.rgb(d3.color(d));s.push({value:u,rgb:[p.r,p.g,p.b]})}else{var g=+d.r,f=+d.g,m=+d.b;g%1==0&&f%1==0&&m%1==0||(l=!0),1==g&l&&(g=255),1==f&l&&(f=255),1==m&l&&(m=255),g%1!=0&&(g=Math.min(255,Math.floor(.5+255*g))),f%1!=0&&(f=Math.min(255,Math.floor(.5+255*f))),m%1!=0&&(m=Math.min(255,Math.floor(.5+255*m))),void 0!==d.v?+d.v:void 0!==d.x?+d.x:u,s.push({value:u,rgb:[g,f,m]})}}}else if("object"==typeof i&&i.colorset)s=i.colorset,i.interpolation&&(n=i.interpolation);else if("string"==typeof i);else if(isFunction(i))for(var v=0;v<100;v++){var b=i(v/99);s.push({value:v/99,rgb:[b.r,b.g,b.b]})}var y=loaded_colormaps[t];if(y&&!o)return y.colormap;var C=new ColorMap(s,n);return loaded_colormaps[t]={colormap:C,m0:e,m1:r},C}return console.error("Could not find preset: "+t),null}function loadExternalColorPresets(t){function e(t,e,r){d3.text(e).then((function(e,o){if(o)throw r(o),o;var a=JSON.parse(e),i=new ColorMap(a.colorset,a.interpolation);COLOR_PRESETS[t]=a,loaded_colormaps[t]={colormap:i,m0:0,m1:1},r()}))}var r=d3.queue();for(var o in COLOR_PRESETS)COLOR_PRESETS.hasOwnProperty(o)&&(preset=COLOR_PRESETS[o],"object"==typeof preset&&preset.URL&&"string"==typeof preset.URL&&r.defer(e,o,preset.URL));r.awaitAll((function(e){if(e)throw e;t&&t()}))}function drawColorPresets(t,e){var r=-Number.MAX_VALUE,o=[];for(var a in COLOR_PRESETS)if(COLOR_PRESETS.hasOwnProperty(a)){var i={name:a,colorSet:COLOR_PRESETS[a],colorMap:getColorPreset(a)};i.colorMap.computeColorDiff(),r=Math.max(r,i.colorMap.maxColorDiff),o.push(i)}console.log("max E: "+r);for(var n=0;n<o.length;n++)o[n].colorMap.scaleColorDiff(r);t.selectAll("image").data(o).enter().append("image").attr("width",120).attr("height",15).attr("x",0).attr("y",(function(t,e){return 20*e})).attr("xlink:href",(function(t,e){return t.colorMap.drawColorScale(120,15,Math.floor(60.5),"horizontal").toDataURL()})).on("click",(function(t){e&&e(getColorPreset(t.name))}))}var TWO_PI=2*Math.PI,SIX=6*Math.PI/180,TWENTY_FIVE=25*Math.PI/180,THIRTY=30*Math.PI/180,SIXTY=2*THIRTY,SIXTY_THREE=SIXTY+SIX/2,TWO_SEVENTY_FIVE=275*Math.PI/180,C25=Math.pow(25,7);function cie76Diff(t,e){return Math.sqrt(Math.pow(t.l-e.l,2)+Math.pow(t.a-e.a,2)+Math.pow(t.b-e.b,2))}function cie2000Diff(t,e){var r,o,a,i=t.l,n=e.l,s=n-i,l=t.a,c=e.a,h=t.b,u=e.b,d=Math.pow(h,2),p=Math.pow(u,2),g=.5*(i+n),f=.5*(Math.sqrt(Math.pow(l,2)+d)+Math.sqrt(Math.pow(c,2)+p)),m=Math.pow(f,7),v=Math.sqrt(m/(m+C25)),b=l+.5*l*(1-v),y=c+.5*c*(1-v),C=Math.sqrt(Math.pow(b,2)+d),x=Math.sqrt(Math.pow(y,2)+p),S=.5*(C+x),R=x-C,w=Math.atan2(h,b)%TWO_PI,M=Math.atan2(u,y)%TWO_PI,P=M-w;0==C||0==x?(r=0,o=0):(r=Math.abs(P)<=Math.PI?P:M<=w?P+TWO_PI:P-TWO_PI,o=2*Math.sqrt(C*x)*Math.sin(.5*r)),a=Math.abs(P)<=Math.PI?w+M:w+M<TWO_PI?w+M+TWO_PI:w+M-TWO_PI,0==C&&0==x||(a*=.5);var k=1-.17*Math.cos(a-THIRTY)+.24*Math.cos(2*a)+.32*Math.cos(3*a+SIX)-.2*Math.cos(4*a-SIXTY_THREE),T=Math.pow(g-50,2),E=1+.015*T/Math.sqrt(20+T),A=1+.045*S,_=1+.015*S*k,I=Math.pow((a-TWO_SEVENTY_FIVE)/TWENTY_FIVE,2),O=-2*v*Math.sin(SIXTY*Math.exp(-I)),L=R/A,D=o/_,G=Math.pow(s/E,2)+Math.pow(L,2)+Math.pow(D,2)+O*L*D;return Math.sqrt(G)}function trimColormap(t,e){var r=COLOR_PRESETS[t],o=[],a=Math.floor(.5+e/2*r.length);if(a>0){for(var i=0,n=a;n<r.length-a;n++,i++){var s=r[n];o.push({r:s.r,b:s.b,g:s.g,x:i/(r.length-2*a-1)})}COLOR_PRESETS[t]=o}}function putNodeOnTop(t){var e=jQuery(t);e.parent().append(e.detach())}function CurvePlotCollection(t,e){this.svg=t,this.plots=[],this.parentGroup=this.svg.append("g"),this.coordsCombo={RGB:[[0,1],[0,2],[1,2]],LAB:[[1,2],[1,0],[2,0]],JAB:[[1,2],[1,0],[2,0]],HSL:[[1,2],[0,1]],HCL:[[1,2],[0,1]]};for(var r=e.getColorSpace(),o=0;o<this.coordsCombo[r].length;o++){var a=this.coordsCombo[r][o],i=new CurvePlot(this.parentGroup.append("g").attr("transform","translate("+(177*o+27)+",0)"),150,150,a,e);i.parent=this,this.plots.push(i)}if(this.coordsCombo[r].length<3){var n=177*(3-this.coordsCombo[r].length)/2;this.parentGroup.attr("transform","translate("+n+",0)")}}CurvePlotCollection.prototype.updateSolution=function(t,e){this.solution=t;for(var r=0;r<this.plots.length;r++)e!=this.plots[r]&&this.plots[r].updateSolution(this.solution);this.editCallback&&this.editCallback(t)},CurvePlotCollection.prototype.updateColorSpace=function(t){for(var e=0;e<this.plots.length;e++)this.plots[e].updateColorSpace(t)},CurvePlotCollection.prototype.setEditCallback=function(t){this.editCallback=t},CurvePlotCollection.prototype.setUpdateCallback=function(t){this.updateCallback=t},CurvePlotCollection.prototype.dispose=function(){this.svg.selectAll("*").remove()};const BEAD_RADIUS=4.5;function CurvePlot(t,e,r,o,a){this.svg=t,this.h=r,this.w=e,this.colorSpace=a,this.coords=o;var i=this.colorSpace.getRange();o=this.coords.slice();this.key1=i[o[0]].key,this.key2=i[o[1]].key,this.autoControl1=1==i[o[0]].autoControl,this.autoControl2=1==i[o[1]].autoControl,this.missingKey=null;for(var n=0;n<3;n++)i[n].key!=this.key1&&i[n].key!=this.key2&&(this.missingKey=i[n].key);this.image=this.svg.append("g").append("image").attr("width",this.w).attr("height",this.h);this.borderRect=this.svg.append("rect").attr("width",e+0).attr("height",r+0).style("stroke","black").style("stroke-width","0.5px").style("fill","none").attr("x",-0),this.bgRect=this.svg.append("rect").attr("width",e).attr("height",r).style("stroke","none").style("stroke-width","0.5px").style("fill","none");var s=this.colorSpace.getRange();this.labelX=this.svg.append("text").attr("class","colorAxisLabel").html(s[this.coords[0]].name).attr("text-anchor","middle").attr("x",(this.w-0)/2).attr("y",this.h+15),this.labelY=this.svg.append("text").html(s[this.coords[1]].name).attr("class","colorAxisLabel");var l=0+this.h/2+this.labelY.node().getComputedTextLength()/2;this.labelY.attr("transform","translate(-4,"+l+") rotate(-90)"),this.groupCurve=this.svg.append("g")}CurvePlot.prototype.updateColorSpace=function(t){this.colorSpace=t,this.solution&&this.updateSolution(this.solution),this.labelX.html(colorSpaceRange[this.coords[0]].name),this.labelY=this.svg.append("text").html(colorSpaceRange[this.coords[1]].name),this.labelY.attr("x",this.labelY.node().getComputedTextLength()-2)},CurvePlot.prototype.getColorFromSlice=function(t,e,r){var o=this.key1,a=this.key2,i=this.missingKey,n={},s=this.colorSpace.getColorFromSolution(this.solution[t]);if(void 0===e&&void 0===r)return s;var l=this.revScale(e,r);return l?(n[o]=l[0],n[a]=l[1],n[i]=s[i],this.colorSpace.createColor(n)):null},CurvePlot.prototype.renderSlice=function(t,e,r){var o=this.getColorFromSlice(t,e,r),a=document.createElement("canvas");a.width=this.w,a.height=this.h;for(var i=a.getContext("2d"),n=0;n<this.h;n+=1)for(var s=n/(this.h-1),l=0;l<this.w;l+=1){var c=l/(this.w-1);if(scaled=this.revScale(c,s),scaled){o[this.key1]=scaled[0],o[this.key2]=scaled[1];var h=this.colorSpace.createColor(o);if(h.displayable()){var u=d3.rgb(h);i.fillStyle=u.toString()}else i.fillStyle="rgb(255, 255, 255, 0)"}else i.fillStyle="rgb(255, 255, 255, 0)";i.fillRect(l,n,1,1)}this.image.attr("xlink:href",a.toDataURL()),this.image.style("opacity",1)},CurvePlot.prototype.moveBead=function(t,e){!function(r){function o(){var t=document.createElement("canvas");t.width=r.w,t.height=r.h,t.getContext("2d").clearRect(0,0,r.w,r.h),r.image.attr("xlink:href",t.toDataURL())}addMMCallback(t,r.bgRect.node(),(function(o,a){r.beadMoved=!0;r.solution[e].slice();var i=+t.attr("cx")/r.w,n=+t.attr("cy")/r.h,s=r.getColorFromSlice(e,r.autoControl1?i:o,r.autoControl2?n:a);s&&s.displayable()&&(t.attr("fill",s.toString()),r.autoControl1||t.attr("cx",o*r.w),r.autoControl2||t.attr("cy",a*r.h),r.editSolution(e,s))}),(function(o,a){putNodeOnTop(t.node()),r.beadMoved=!1,r.beadDragging=!0,r.beads.style("opacity",.05),r.path.style("opacity",.3),t.style("opacity",1),t.attr("r",6.75),r.renderSlice(e,o,a)}),(function(){r.beads.style("opacity",null),r.path.style("opacity",null),t.attr("r",4.5),o(),r.beadMoved&&r.parent.updateCallback&&r.parent.updateCallback(r.solution,e),r.beadMoved=!1,r.beadDragging=!1}),(function(o,a){putNodeOnTop(t.node()),t.style("stroke-width","1.5px"),void 0!==r.clearTimeout&&(clearTimeout(r.clearTimeout),r.clearTimeout=void 0),r.beadDragging||r.renderSlice(e,o,a)}),(function(e,a){t.style("stroke-width","1px"),r.beadDragging||(r.clearTimeout=setTimeout((function(){o()}),20))}),4)}(this)},CurvePlot.prototype.editSolution=function(t,e){var r,o,a;function i(e,r){var o=d3.lab(r);e.solution[t]=[o.l,o.a,o.b],e.path&&e.path.attr("d",e.lineGen(e.solution)),e.parent&&e.parent.updateSolution(e.solution,e),e.lastEditTime=Date.now()}if(void 0!==this.lastEditTime){var n=Date.now()-this.lastEditTime;if(n<30)return o=e,a=30-n,void 0!==(r=this).scheduledEdit&&clearTimeout(r.scheduledEdit),void(r.scheduledEdit=setTimeout((function(){i(r,o),r.scheduledEdit=void 0}),a))}i(this,e)},CurvePlot.prototype.updateSolution=function(t){t&&(this.solution=t),this.path||(this.path=this.svg.append("path").attr("class","colorCurvePath")),this.beads=this.svg.selectAll("circle.colorCurveBeads").data(t),this.beads=this.beads.enter().append("circle").attr("class","colorCurveBeads").attr("r",4.5).merge(this.beads),this.beads.exit().remove(),function(t,e){var r=function(e,r){var o=t.coords[r],a=t.colorSpace.getRange()[o].key,i=t.colorSpace.getColorFromSolution(e),n=t.colorSpace.revScaleRange(i[a],o);return isNaN(n)&&console.log("error NaN in revRange"),n},o=function(e,r){return[t.colorSpace.scaleRange(e,t.coords[0]),t.colorSpace.scaleRange(r,t.coords[1])]},a=function(e){return t.w*r(e,0)},i=function(e){return t.h*r(e,1)},n=function(e){var r=t.colorSpace.getColorFromSolution(e),o=isNaN(r.h)?0:r.h;o>180&&(o-=360);var a=o*(Math.PI/180),i=r.s?r.s:r.c,n=Math.min(t.w,t.h)/2*t.colorSpace.revScaleRange(i,1);return[n*Math.cos(a)+t.w/2,n*Math.sin(a)+t.h/2]};0!=t.coords[0]||1!=t.coords[1]||"HSL"!=t.colorSpace.getColorSpace()&&"HCL"!=t.colorSpace.getColorSpace()||(a=function(t){return n(t)[0]},i=function(t){return n(t)[1]},o=function(e,r){var o=e-.5,a=r-.5,i=Math.sqrt(Math.pow(o,2)+Math.pow(a,2));return i>.5?null:[Math.atan2(a/i,o/i)*(180/Math.PI),t.colorSpace.scaleRange(2*i,1)]});var s=d3.line().x((function(t){return a(t)})).y((function(t){return i(t)}));t.xScale=a,t.yScale=i,t.revScale=o,t.lineGen=s,t.path.attr("d",s(e)),t.beads.attr("cx",(function(t){return a(t)})).attr("cy",(function(t){return i(t)})).attr("fill",(function(e){var r=t.colorSpace.getColorFromSolution(e);return d3.rgb(r).toString()})).on("mouseover",(function(){putNodeOnTop(this),d3.select(this).style("stroke-width","1.5px")})).on("mouseout",(function(){d3.select(this).style("stroke-width",null)})),t.beads.each((function(e,r){t.moveBead(d3.select(this),r)}))}(this,t)};var HIST_SERIAL=0,ELEMENT_H=26,COLORMAP_HIST_H=ELEMENT_H-6,COLORMAP_HIST_W=200,TRANSITION_TIME=100;function HistoryElement(t,e){this.children=[],this.solution=t,this.score=e,this.expanded=!1,this.serial=HIST_SERIAL++,this.userPrefs=scaffold.copyUserPrefs()}var histTimeout=null;function previewHistory(t){null!=histTimeout&&(clearTimeout(histTimeout),histTimeout=null),d3.select("#colormapStats").selectAll("path").remove(),d3.select("#colormapStats").selectAll("circle").remove(),d3.select("g#colormapUI").selectAll("rect.userPrefColors").remove(),d3.select("g#colormapUI").selectAll("image.userPrefGradient").remove(),d3.selectAll(".cvdImage, .cvdText").remove(),opt.updateSolution(copySolution(t.solution)),examples.setColorMap(opt.getColorMap()),combinedMapModule.updateChoroplethMap1(opt.getColorMap()),combinedMapModule.updateChoroplethMap2(opt.getColorMap()),scaffold.flashUserPrefs(t.userPrefs),scaffold.addCallback(t.luminanceProfile),1==binImgFlag&&loadAndDisplayImage(opt.getColorMap());var e=document.getElementById("visionDropdown").value;if("normal"!==e){var r=cvdSimulation(opt.getColorMap(),e);drawCVDImage(r)}d3.selectAll(".linesButton:checked").nodes().forEach((function(t){let e=t.id;"luminance"===e?drawLumGraph(opt.getColorMap()):"perc_uniformity"===e?drawPUGraph(opt.getColorMap()):"smoothness"===e&&drawSmoGraph(opt.getSolution())})),appendElements(opt.getSolution()),updateLuminanceProfile(t.luminanceProfile)}function returnPreviewToTop(){var t=hist;null!=histTimeout&&(clearTimeout(histTimeout),histTimeout=null),histTimeout=setTimeout((function(){if(t.list[histCurr]){var e=t.list[histCurr];previewHistory(e),scaffold.restoreUserPrefs(e.userPrefs),updateLuminanceProfile(profileSelection||e.luminanceProfile)}}),100)}function moveSelectionMarker(t){if(void 0===t&&(t=histCurr),0==hist.list.length)d3.selectAll("rect.histBut").remove();else{var e=d3.selectAll("rect.histBut");0==e.size()&&(e=d3.select("g#historyGroup").append("rect").attr("class","histBut").attr("class","histBut").attr("width",COLORMAP_HIST_W).attr("height",COLORMAP_HIST_H).style("fill","none").style("stroke","black").style("stroke-width","1px")),e.attr("y",ELEMENT_H*t),putNodeOnTop(e.node()),d3.selectAll("image.previewIcon").style("opacity","0.2"),hist.list[t].imagePreview.style("opacity","1.0")}}function changeSelectedHistory(t){t?histCurr=hist.findIndex(t):t=hist.list[histCurr],previewHistory(t),moveSelectionMarker();var e=hist;d3.select("g#colormapUI").selectAll("rect.userPrefColors").remove(),d3.select("g#colormapUI").selectAll("image.userPrefGradient").remove(),d3.selectAll(".cvdImage, .cvdText").remove(),d3.select("g#colormapUI").selectAll("rect.userPrefColors").remove(),d3.select("g#colormapUI").selectAll("image.userPrefGradient").remove(),scaffold.setNewPrefs(t.userPrefs),opt.updateSolution(copySolution(t.solution)),examples.setColorMap(t.colormap),combinedMapModule.updateChoroplethMap1(t.colormap),combinedMapModule.updateChoroplethMap2(t.colormap),scaffold.addCallback(t.luminanceProfile),1==binImgFlag&&loadAndDisplayImage(t.colormap);var r=document.getElementById("visionDropdown").value;if("normal"!==r){var o=cvdSimulation(t.colormap,r);drawCVDImage(o)}d3.selectAll(".linesButton:checked").nodes().forEach((function(t){let e=t.id;"luminance"===e?drawLumGraph(opt.getColorMap()):"perc_uniformity"===e?drawPUGraph(opt.getColorMap()):"smoothness"===e&&drawSmoGraph(opt.getSolution())})),appendElements(e.list[histCurr].solution),updateLuminanceProfile(t.luminanceProfile)}function HistoryWidget(t,e){this.svg=t,this.w=e,this.list=[],this.updateSize()}function drawAxes(){let t=d3.select("#svgLines");var e=d3.scaleLinear().domain([0,100]).range([0,540]);t.append("g").attr("transform","translate(15,120)").call(d3.axisBottom(e).tickValues([]));var r=d3.scaleLinear().domain([100,0]).range([0,80]);t.append("g").attr("transform","translate(15,40)").call(d3.axisLeft(r).tickValues([]))}function drawLumGraph(t){let e=d3.select("#svgLines");e.selectAll("path.lineGraphLum").remove(),e.selectAll("text.lumLabel").remove();var r=+d3.select("#svgLines").attr("width")-15,o=+d3.select("#svgLines").attr("height")-55,a=d3.line().x((function(t){return t.x*r})).y((function(t){return(1-t.y)*o+40}));let i=t.colorMap;var n=[];for(let t=0,e=i.length;t<e;t++){var s=t/(i.length-1),l=i[t].lab.l;n.push({x:s,y:l/100})}e.append("path").attr("class","lineGraphLum").attr("d",a(n)).style("fill","none").attr("stroke-dasharray","4 1").style("stroke","black").style("stroke-width","1.5px").attr("transform","translate(15,0)"),e.append("text").attr("class","lumLabel").attr("x",r-45).attr("y",(1-n[n.length-1].y)*o+55).style("font-size","12px").style("fill","black").text("Luminance")}function drawPUGraph(t){let e=d3.select("#svgLines");e.selectAll("text.PULabel").remove(),e.selectAll("path.lineGraphPU").remove();var r=+d3.select("#svgLines").attr("width")-15,o=+d3.select("#svgLines").attr("height")-55,a=d3.line().x((function(t){return t.x*r})).y((function(t){return(1-t.y)*o+40}));let i=t.colorMap;var n=[],s=[];for(let t=0,e=i.length-1;t<e;t++){var l=i[t].lab,c=i[t+1].lab,h=cie2000Diff({l:l.l,a:l.a,b:l.b},{l:c.l,a:c.a,b:c.b});s.push(h);var u=s.reduce((function(t,e){return Math.max(t,e)}),.1);n.push({x:t/(i.length-1),y:h/u})}e.append("path").attr("class","lineGraphPU").attr("d",a(n)).style("fill","none").style("stroke","#3A4CE3").style("stroke-width","1.5px").attr("transform","translate(15,0)"),e.append("text").attr("class","PULabel").attr("x",r-100).attr("y",(1-n[n.length-1].y)*o+30).style("font-size","12px").style("fill","#3A4CE3").text("CIE ΔE2000")}function drawSmoGraph(t){let e=d3.select("#svgLines");e.selectAll("path.lineGraphSmo").remove(),e.selectAll("text.SmoLabel").remove();var r=+d3.select("#svgLines").attr("width")-15,o=+d3.select("#svgLines").attr("height")-55,a=d3.line().x((function(t){return t.x*r})).y((function(t){return(1-t.y)*o+40})),i=[],n=[];for(let e=1,r=t.length-1;e<r;e++){var s=t[e-1],l=t[e],c=t[e+1],h=delta(l,s),u=delta(c,l),d=dot(h,u)/(length(h)*length(u));cosineNorm=-.5*d+.5,n.push(cosineNorm);var p=n.reduce((function(t,e){return Math.max(t,e)}),.1);i.push({x:e/(t.length-1),y:cosineNorm/p})}e.append("path").attr("class","lineGraphSmo").attr("d",a(i)).style("fill","none").style("stroke","#D20EAB").style("stroke-width","1.5px").attr("transform","translate(15,0)"),e.append("text").attr("class","SmoLabel").attr("x",r-55).attr("y",(1-i[i.length-1].y)*o+30).style("font-size","12px").style("fill","#D20EAB").text("Smoothness")}HistoryElement.prototype.render=function(t){histCurr=0,this.colormap=colormapFromSolution(this.solution);var e,r,o=this.historyWidget,a=t.append("g");d3.selectAll("rect.hist").style("stroke-width","0px"),r=this,(e=a).append("image").attr("xlink:href","profile/close-button-black.png").attr("x",-COLORMAP_HIST_H-2).attr("width",COLORMAP_HIST_H).attr("height",COLORMAP_HIST_H).style("opacity","0.2").on("mouseover",(function(){d3.select(this).style("opacity","1.0")})).on("mouseout",(function(){d3.select(this).style("opacity","0.2")})).on("click",(function(){e.selectAll("*").remove(),r.historyWidget.deleteElement(r)})),r.imagePreview=e.append("image").attr("xlink:href","profile/preview.png").attr("x",COLORMAP_HIST_W+2).attr("width",1.5*COLORMAP_HIST_H).attr("height",COLORMAP_HIST_H).style("opacity","0.2").attr("class","previewIcon").on("mouseover",(function(){d3.select(this).style("opacity","1.0"),previewHistory(r)})).on("mouseout",(function(){d3.select(this).style("opacity","0.2"),returnPreviewToTop(),moveSelectionMarker()})).on("click",(function(){changeSelectedHistory(r)})),r.image=e.append("image").attr("x",0).attr("y",0).data([{serial:r.serial}]).attr("width",COLORMAP_HIST_W).attr("height",COLORMAP_HIST_H).attr("xlink:href","your-image-url.jpg").on("click",(function(){changeSelectedHistory(r)})),moveSelectionMarker();var i=d3.select("#downArrow");1==o.list.length?i.attr("fill","#a9a9a9").on("mouseover",(function(){i.style("cursor","not-allowed")})):(i.attr("fill","#222021"),i.on("mouseover",(function(){histCurr==o.list.length-1?i.attr("fill","#a9a9a9").style("cursor","not-allowed"):i.attr("fill","#222021").style("cursor","pointer")})).on("click",(function(){histCurr<o.list.length-1&&(n.attr("fill","#222021"),histCurr++,changeSelectedHistory(o.list[histCurr]))})));var n=d3.select("#upArrow");1==o.list.length?n.attr("fill","#a9a9a9").on("mouseover",(function(){n.style("cursor","not-allowed")})):(n.attr("fill","#a9a9a9"),n.on("mouseover",(function(){0===histCurr?n.attr("fill","#a9a9a9").style("cursor","not-allowed"):n.attr("fill","#222021").style("cursor","pointer")})).on("click",(function(){histCurr>0&&(i.attr("fill","#222021"),histCurr--,changeSelectedHistory(o.list[histCurr]))}))),colormapToImage(this.colormap,this.image)},HistoryWidget.prototype.findIndex=function(t){for(var e=0,r=this.list.length;e<r;e++)if(this.list[e]==t)return e;return-1},HistoryWidget.prototype.deleteElement=function(t){var e=this.findIndex(t);this.list.splice(e,1),this.shiftDown(e),0==this.list.length?histCurr=Math.max(0,Math.min(histCurr,this.list.length-1)):e>histCurr||(e==histCurr?(histCurr<this.list.length||histCurr--,changeSelectedHistory()):e<histCurr&&histCurr--),histCurr=Math.max(0,Math.min(histCurr,this.list.length-1)),moveSelectionMarker(),this.updateSize()},HistoryWidget.prototype.shiftDown=function(t){for(var e=0,r=0;r<t&&r<this.list.length;r++)e+=ELEMENT_H,this.list[r].expanded&&(e+=this.list[r].children.length*ELEMENT_H);var o=0;for(r=t;r<this.list.length;r++,o++){var a=e+o*ELEMENT_H,i=this.list[r].serial;d3.select("#history_"+i).transition().duration(TRANSITION_TIME).attr("transform","translate(0,"+a+")")}},HistoryWidget.prototype.updateSize=function(){d3.select("#historyGroup");var t=ELEMENT_H*this.list.length;d3.select("#svgHistory").attr("height",t+30)},HistoryWidget.prototype.add=function(t,e){var r=new HistoryElement(copySolution(t),e);r.historyWidget=this,r.luminanceProfile=getLuminanceProfile().getProfileType(),this.list.splice(0,0,r),this.shiftDown(1,ELEMENT_H);var o=this.svg.append("g").attr("id","history_"+r.serial).attr("transform","translate(0,0)");r.render(o),this.updateSize()},HistoryWidget.prototype.clear=function(){histTop=0,histCurr=0,this.list=[],this.svg.selectAll("*").remove(),this.updateSize()};var UPDATE_EVERY=200;function colormapFromSolution(t){for(var e=[],r=0,o=t.length;r<o;r++){var a=t[r],i={value:r/(o-1),lab:{l:a[0],a:a[1],b:a[2]}};e.push(i)}return new ColorMap(e,"lab")}function colormapToImage(t,e,r){var o=t.drawColorScale(+e.attr("width"),+e.attr("height"),+e.attr("width"),r||"horizontal");e.attr("xlink:href",o.toDataURL())}function OptimizerWrapper(t){this.callbacks=[],this.scaffold=t,this.optimizer=new Optimizer,this.userModel=new UserModel,this.plotSolution(),this.plotCurvesNew()}OptimizerWrapper.prototype.cancelScheduledRun=function(){void 0!==this.reRunTimeout&&(clearTimeout(this.reRunTimeout),this.reRunTimeout=void 0),this.running&&(d3.select("#statusText").html(""),this.stop())},OptimizerWrapper.prototype.scheduleReRun=function(t,e){const r=e?15:1500;var o;this.running&&(d3.select("#statusText").html(""),this.stop()),void 0!==this.reRunTimeout&&(clearTimeout(this.reRunTimeout),this.reRunTimeout=void 0),(o=this).reRunTimeout=setTimeout((function(){o.reRunTimeout=void 0,t?o.run():o.reRun()}),r)},OptimizerWrapper.prototype.reRun=function(){var t=!0;this.solution||(t=!1),this.threaded(1,t)},OptimizerWrapper.prototype.run=function(t){this.threaded(t)},OptimizerWrapper.prototype.getSolution=function(){return this.solution?this.solution:this.optimizer.getSolution()};var WORKER_COUNT=1;function createOffscreenCanvas(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}OptimizerWrapper.prototype.threaded=function(t,e){var r,o=t||WORKER_COUNT,a=e?.01:null,i=e?Math.ceil(2.5*ITERATIONS_PER_TEMP):null,n=e?.5:null,s=e&&this.solution?this.solution:null;this.threadedOpt=new ThreadedOptimizer(o,a,i,n,s),this.running=!0,this.secondsRemaining=void 0,(r=this).threadedOpt.run((function(t,e){if(r.secondsRemaining=r.threadedOpt.getRemainingSeconds(),e){r.threadedOpt.stop(),r.running=!1,r.secondsRemaining=void 0;for(var o=t.length-1;o>=0;o--)o>0&&hist.add(t[o].solution,t[o].solutionCost);r.uneditedSolution=copySolution(t[0].solution)}for(o=0;o<r.callbacks.length;o++)t[0]&&(r.solution=t[0].solution,r.callbacks[o](e),r.plotSolution())}))},OptimizerWrapper.prototype.getRemainingSeconds=function(){return this.secondsRemaining},OptimizerWrapper.prototype.optimizerLoop=function(){this.userModel=new UserModel(this.scaffold?this.scaffold.getUserPrefs():null),this.userBias=this.userModel.getBias(),this.running=!0;var t,e=this.optimizer.optimize(this.userBias,UPDATE_EVERY);this.solution=this.optimizer.getSolution(),this.plotSolution();for(var r=0;r<this.callbacks.length;r++)this.callbacks[r](e||this.stopped);if(this.secondsRemaining=void 0,e)this.running=!1;else if(this.paused||this.stopped)this.stopped?(this.stopped=!1,this.running=!1,this.optimizer.clearLastState()):(this.paused=!1,this.running=!1);else{var o=this.optimizer.lastState,a=o.percentDone,i=(1-a)/a*(Date.now()-o.startTime),n=Math.ceil(i/1e3);this.secondsRemaining=n,t=this,setTimeout((function(){t.optimizerLoop()}),15)}return this.uneditedSolution=copySolution(this.solution),this.solution},OptimizerWrapper.prototype.pause=function(){this.paused=!0},OptimizerWrapper.prototype.stop=function(){if(this.threadedOpt&&this.isRunning()){this.threadedOpt.stop(),this.running=!1;var t=this.threadedOpt.getFirstSolution();t&&(this.uneditedSolution=copySolution(t),this.solution=copySolution(t))}this.stopped=!0},OptimizerWrapper.prototype.isRunning=function(){return!0===this.running},OptimizerWrapper.prototype.addCallback=function(t){this.callbacks.push(t)},OptimizerWrapper.prototype.getColorMap=function(){return this.colormap},OptimizerWrapper.prototype.editKey=function(t,e){this.solution[t]=e,this.updateColormap(),examples.setColorMap(this.getColorMap())},OptimizerWrapper.prototype.unedit=function(){this.solution=copySolution(this.uneditedSolution),this.updateColormap(),examples.setColorMap(this.getColorMap())},OptimizerWrapper.prototype.plotCurvesNew=function(){var t;(this.plots&&(this.plots.dispose(),this.plots=null),this.plots=new CurvePlotCollection(d3.select("#colormapStats"),getColorSpace()),this.solution)&&(this.plots.updateSolution(this.solution),(t=this).plots.setEditCallback((function(e){this.solution=e,t.updateColormap(),examples.setColorMap(t.getColorMap())})),t.plots.setUpdateCallback((function(e,r){var o=r/(e.length-1),a=e[r];t.scaffold.addEditedColorPref(r,o,a),t.scheduleReRun()})))},OptimizerWrapper.prototype.updateColorSpace=function(){this.plotCurvesNew()},OptimizerWrapper.prototype.deliverSolution=function(t){this.uneditedSolution=copySolution(t),this.updateSolution(t);for(var e=0;e<this.callbacks.length;e++)this.callbacks[e](!0)},OptimizerWrapper.prototype.updateSolution=function(t){t&&(this.solution=t,this.uneditedSolution=copySolution(t)),this.plotSolution()},OptimizerWrapper.prototype.updateColormap=function(){this.colormap=colormapFromSolution(this.solution),colormapToImage(this.colormap,d3.select("#colormapImage"))},OptimizerWrapper.prototype.plotSolution=function(){this.solution&&(this.updateColormap(),this.plotCurvesNew())};var CVD_PICKER=!1,PICKER_MODE_HSL=1,PICKER_MODE_LAB=2,GRADIENT_PAD=6,GRADIENT_H=30,PICKER_STEP=2,mDown=null,minDistanceAchieved=!1;function Picker(t,e,r,o){this.svg=t,this.w=e,this.h=r,this.mode=PICKER_MODE_HSL,this.callbacks=[];var a=d3.lab(d3.rgb("rgb(72, 184, 255)")),i=this.getArrayedColor(this.getColorFromLAB(a)),n=this.revScaleRange(i[0],0),s=[this.revScaleRange(i[1],1),this.revScaleRange(i[2],2)];this.gradientPos=o?o[0]:n,this.slicePos=o?[o[1],o[2]]:s;var l,c,h,u=this.h,d=this.h,p=this.w-(d+GRADIENT_PAD),g=this.h-(GRADIENT_H+GRADIENT_PAD);this.imageSlice=this.svg.append("image").attr("x",0).attr("y",0).attr("width",p).attr("height",g),this.imageGradient=this.svg.append("image").attr("x",0).attr("y",g+GRADIENT_PAD).attr("width",p).attr("height",GRADIENT_H),this.pickedColor=this.svg.append("rect").attr("id","selectedColor").attr("x",p+GRADIENT_PAD).attr("y",0).style("stroke","black").style("stroke-width","1px").attr("width",d).attr("height",u).on("mouseover",(function(){showTooltip("Drag Color below to the Shelf to generate Colormap")})).on("mousemove",updateTooltip).on("mouseout",hideTooltip),this.text=new ShadowedText(this.svg).setX(p+4+GRADIENT_PAD+1).setY(115).attr("class","smallText selectedText"),this.selectorG=this.svg.append("g"),this.selectorG.append("circle").attr("class","selectIndicator").attr("id","gradientSelector2").attr("r",6).attr("cy",g+GRADIENT_PAD+GRADIENT_H/2+1).attr("cx",this.gradientPos*p+1).style("fill","none").style("stroke","white"),this.selectorG.append("circle").attr("class","selectIndicator").attr("id","gradientSelector1").attr("r",6).attr("cy",g+GRADIENT_PAD+GRADIENT_H/2).attr("cx",this.gradientPos*p).style("fill","none").style("stroke","black"),this.selectorG.append("circle").attr("class","selectIndicator").attr("id","sliceSelector2").attr("r",6).attr("cy",this.slicePos[1]*g+1).attr("cx",this.slicePos[0]*p+1).style("fill","none").style("stroke","white"),this.selectorG.append("circle").attr("class","selectIndicator").attr("id","sliceSelector1").attr("r",6).attr("cy",this.slicePos[1]*g).attr("cx",this.slicePos[0]*p).style("fill","none").style("stroke","black"),this.renderGradient(),this.renderSlice(),this.updateColor(),this.lastSliceRender=void 0,c=function(t){l.adjustGradientPos(t)},h=function(t,e){l.adjustSlicePos([t,e])},addMMCallback((l=this).imageGradient,null,c,c),addMMCallback(l.imageSlice,null,h,h)}function isValidHex(t){return/([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(t)}function updateColorFromHex(t){if(isValidHex(t)){var e=d3.rgb("#"+t),r=d3.lab(e);r.displayable()&&(picker.setLABColor(r),picker.updateColor())}}Picker.prototype.dispose=function(){this.svg.selectAll("*").remove()},Picker.prototype.addCallback=function(t){this.callbacks.push(t)},Picker.prototype.updateColor=function(t){t=this.getLABColor();this.pickedColor.style("fill",this.getColor().toString());const e=Object.values(this.getColor()),r=Object.keys(this.getColor());let o=(r[0]+r[1]+r[2]).toUpperCase()+" ("+parseInt(e[0])+", "+parseInt(e[1])+", "+parseInt(e[2])+")";r[0]+r[1]+r[2]=="hsl"&&(o=(r[0]+r[1]+r[2]).toUpperCase()+" ("+parseInt(e[0])+", "+parseInt(100*e[1])+", "+parseInt(100*e[2])+")");d3.rgb(t.rgb().toString());var a=t.formatHex().substr(1);document.getElementById("hexColor").value=a,this.text.setText(o),t.l>60?this.text.lightBackground():this.text.darkBackground();for(var i=0;i<this.callbacks.length;i++)this.callbacks(t)},Picker.prototype.getLABColor=function(){var t=this.getColor();return d3.lab(t)},Picker.prototype.createColor=function(t){return this.colorConstructor(t[this.range[0].key],t[this.range[1].key],t[this.range[2].key])},Picker.prototype.getColor=function(){var t=this.scaleRange(this.gradientPos,0),e=this.scaleRange(this.slicePos[0],1),r=this.scaleRange(this.slicePos[1],2);return this.colorConstructor(t,e,r)},Picker.prototype.setLABColor=function(t){var e=this.colorConstructor(t);this.gradientPos=this.revScaleRange(e[this.range[0].key],0),this.slicePos=[this.revScaleRange(e[this.range[1].key],1),this.revScaleRange(e[this.range[2].key],2)],this.adjustGradientPos(this.gradientPos),this.adjustSlicePos(this.slicePos)},Picker.prototype.sliceColor=function(t,e,r){return this.colorConstructor(this.scaleRange(t,0),this.scaleRange(e,1),this.scaleRange(r,2)).toString()},Picker.prototype.setRGBColor=function(t){t.r=Math.max(0,Math.min(255,t.r)),t.g=Math.max(0,Math.min(255,t.g)),t.b=Math.max(0,Math.min(255,t.b));var e=d3.lab(t);this.setLABColor(e)},Picker.prototype.getRGBColor=function(){return d3.rgb(this.getColor())},Picker.prototype.adjustGradientPos=function(t){this.gradientPos=t,this.renderSlice(),this.selectorG.select("#gradientSelector1").attr("cx",t*+this.imageGradient.attr("width")),this.selectorG.select("#gradientSelector2").attr("cx",t*+this.imageGradient.attr("width")),this.updateColor()},Picker.prototype.adjustSlicePos=function(t){this.slicePos=t,this.selectorG.select("#sliceSelector1").attr("cx",t[0]*+this.imageSlice.attr("width")).attr("cy",t[1]*+this.imageSlice.attr("height")),this.selectorG.select("#sliceSelector2").attr("cx",1+t[0]*+this.imageSlice.attr("width")).attr("cy",1+t[1]*+this.imageSlice.attr("height")),this.updateColor()},Picker.prototype.gradientColor=function(t){return console.error("unimplemented"),null},Picker.prototype.gradientSlice=function(t,e){return console.error("unimplemented"),null},Picker.prototype.getColorSpace=function(){return console.error("getColorSpace abstract not implemented"),null},Picker.prototype.renderGradient=function(t){var e=+this.imageGradient.attr("width"),r=+this.imageGradient.attr("height"),o=createOffscreenCanvas(e,r),a=o.getContext("2d");a.strokeStyle="black";for(var i=0;i<e;i+=PICKER_STEP)a.fillStyle=this.gradientColor(i/(e-1)),a.fillRect(i,0,PICKER_STEP,r);this.imageGradient.attr("xlink:href",o.toDataURL())},Picker.prototype.actualSliceRender=function(){for(var t=+this.imageSlice.attr("width"),e=+this.imageSlice.attr("height"),r=createOffscreenCanvas(t,e),o=r.getContext("2d"),a=0;a<e;a+=PICKER_STEP)for(var i=a/(e-1),n=0;n<t;n+=PICKER_STEP){var s=n/(t-1);o.fillStyle=this.sliceColor(this.gradientPos,s,i),o.fillRect(n,a,PICKER_STEP,PICKER_STEP)}this.imageSlice.attr("xlink:href",r.toDataURL()),this.lastSliceRender=Date.now()},Picker.prototype.renderSlice=function(t){var e,r;if(void 0!==this.lastSliceRender){var o=Date.now()-this.lastSliceRender;if(o<30)return r=30-o,void 0!==(e=this).renderCall&&clearTimeout(e.renderCall),void(e.renderCall=setTimeout((function(){e.actualSliceRender()}),r))}this.actualSliceRender()},Picker.prototype.getRange=function(){return this.range},Picker.prototype.render=function(){},Picker.prototype.setRange=function(t){this.range=t},Picker.prototype.scaleRange=function(t,e){var r=this.range[e].range;return t*(r[1]-r[0])+r[0]},Picker.prototype.revScaleRange=function(t,e){var r=this.range[e].range;return(t-r[0])/(r[1]-r[0])},Picker.prototype.getArrayedColor=function(t){var e=this.range[0].key,r=this.range[1].key,o=this.range[2].key;return[t[e],t[r],t[o]]},Picker.prototype.getColorFromSolution=function(t){var e=d3.lab(t[0],t[1],t[2]);return this.getColorFromLAB(e)},Picker.prototype.getColorFromLAB=function(t){return this.colorConstructor(t)};var HSL_RANGE=[{key:"h",range:[0,360],name:"Hue",autoControl:!1},{key:"s",range:[0,1],name:"Saturation",autoControl:!1},{key:"l",range:[0,1],name:"Luminance",autoControl:!0}];function PickerHSL(t,e,r){this.colorConstructor=d3.hsl,this.setRange(HSL_RANGE),Picker.call(this,t,e,r)}PickerHSL.prototype=Object.create(Picker.prototype),PickerHSL.prototype.getColorSpace=function(){return"HSL"},PickerHSL.prototype.gradientColor=function(t){var e=this.scaleRange(t,0);return d3.hsl(e,1,.5).toString()};var RGB_RANGE=[{key:"r",range:[0,255],name:"Red",autoControl:!1},{key:"g",range:[0,255],name:"Green",autoControl:!1},{key:"b",range:[0,255],name:"Blue",autoControl:!1}];function PickerRGB(t,e,r){this.colorConstructor=d3.rgb,this.setRange(RGB_RANGE),Picker.call(this,t,e,r)}PickerRGB.prototype=Object.create(Picker.prototype),PickerRGB.prototype.getColorSpace=function(){return"RGB"},PickerRGB.prototype.gradientColor=function(t){var e=this.scaleRange(t,0);return d3.rgb(e,0,0).toString()};var HCL_RANGE=[{key:"h",range:[-180,180],name:"Hue",autoControl:!1},{key:"c",range:[.1,135],name:"Chroma",autoControl:!1},{key:"l",range:[0,100],name:"Luminance",autoControl:!0}];function PickerHCL(t,e,r){this.colorSpaceName="HCL",this.colorConstructor=d3.hcl,this.setRange(HCL_RANGE),this.range[0].range=[0,360],Picker.call(this,t,e,r)}PickerHCL.prototype=Object.create(Picker.prototype),PickerHCL.prototype.getColorSpace=function(){return"HCL"},PickerHCL.prototype.gradientColor=function(t){var e=this.scaleRange(t,0);return d3.hcl(e,100,55).toString()},PickerHCL.prototype.sliceColor=function(t,e,r){var o=this.scaleRange(t,0);return(e=d3.hcl(o,this.scaleRange(e,1),this.scaleRange(r,2))).displayable()?e.toString():"rgb(255, 255, 255, 0)"};var LAB_RANGE=[{key:"l",range:[0,100],name:"Luminance",autoControl:!0,slices:100},{key:"a",range:[-110,110],name:"Green - Red",slices:200},{key:"b",range:[110,-110],name:"Yellow - Blue"}];function PickerLAB(t,e,r){this.colorSpaceName="LAB",this.colorConstructor=d3.lab,this.setRange(LAB_RANGE),Picker.call(this,t,e,r,[.5,.5,.5])}PickerLAB.prototype=Object.create(Picker.prototype),PickerLAB.prototype.getColorSpace=function(){return"LAB"},PickerLAB.prototype.gradientColor=function(t){return d3.lab(this.scaleRange(t,0),0,0).toString()},PickerLAB.prototype.sliceColor=function(t,e,r){var o=this.scaleRange(t,0),a=this.scaleRange(e,1),i=this.scaleRange(r,2),n=d3.lab(o,a,i);if(n.displayable()){if(CVD_PICKER){var s=getCVDModel();return s.colorInModel(n)?s.transformLAB(n).toString().toString():"rgb(255, 255, 255, 0)"}return n.toString()}return"rgb(255, 255, 255, 0)"};var JAB_RANGE=[{key:"J",range:[0,100],name:"Luminance",autoControl:!0},{key:"a",range:[-45,45],name:"Green - Red"},{key:"b",range:[45,-45],name:"Yellow - Blue"}];function PickerJAB(t,e,r){this.colorSpaceName="JAB",this.colorConstructor=d3.jab,this.setRange(JAB_RANGE),Picker.call(this,t,e,r,[.5,.5,.5])}PickerJAB.prototype=Object.create(Picker.prototype),PickerJAB.prototype.getColorSpace=function(){return"JAB"},PickerJAB.prototype.gradientColor=function(t){var e=this.scaleRange(t,0);return d3.jab(e,0,0).toString()},PickerJAB.prototype.sliceColor=function(t,e,r){var o=this.getColor(t,e,r);return o.displayable()?o.toString():"rgb(255, 255, 255, 0)"},PickerJAB.prototype.getColor=function(t,e,r){JAB_RANGE[0].range,JAB_RANGE[1].range,JAB_RANGE[2].range;var o=this.scaleRange(void 0!==t?t:this.gradientPos,0),a=this.scaleRange(void 0!==e?e:this.slicePos[0],1),i=this.scaleRange(void 0!==r?r:this.slicePos[1],2);return d3.jab(o,a,i)},PickerJAB.prototype.getColorFromSolution=function(t){var e=d3.lab(t[0],t[1],t[2]);return 0==e.l&&(e.l=.1),d3.jab(e)};var RAMP_EDITOR=null;function RampEditor(t,e){this.svg=t.append("g"),this.uiWidth=e,RAMP_EDITOR=this}RampEditor.prototype.dispose=function(){this.svg&&this.svg.selectAll("*").remove()},RampEditor.prototype.selfRemove=function(){var t;(t=this).removeTimeout=setTimeout((function(){t.dispose()}),500)},RampEditor.prototype.cancelSelfRemove=function(){null!==this.removeTimeout&&void 0!==this.removeTimeout&&(clearTimeout(this.removeTimeout),this.removeTimeout=null)},RampEditor.prototype.setCallback=function(t,e){this.previewCallback=t,this.editCallback=e},RampEditor.prototype.render=function(t,e,r){this.cancelSelfRemove(),this.dispose();for(var o,a,i=[{key:"c",step:7,name:"Chroma",range:[0,100]},{key:"h",step:40,name:"Hue",range:[0,280]}],n=18,s=[],l=0,c=0,h=0;h<i.length;h++){var u=i[h],d=u.key,p=u.range,g=u.step,f=[],m=null;for(var v=0;v<4;v++){for(var b=10,y=0;y<2;y++){var C=d3.hcl(t),x=0==y?-1:1,S=d3.lab(C);do{if(C[d]+=x*g,C.displayable()||"h"==d){if("h"==d)for(h=100;h>=0&&(C.c=h,!C.displayable());h-=2);var R="c"==d?b/2.5:b;S&&(o=S,a=C,cie2000Diff(d3.lab(o),d3.lab(a))>R)&&(f.push({keyIndex:e,color:d3.lab(C),original:!1}),S=d3.lab(C))}}while(C[d]>=p[0]&&C[d]<=p[1]&&("h"==d||C.displayable()));0==y&&(f.reverse(),f.push({keyIndex:e,color:d3.lab(t),original:!0}),m=f.length)}if(!(f.length<2&&v<3&&"h"==d))break;console.log("retrying: "+f.length),b*=.5,g*=.5,f=[]}(T={rowCenter:m,gradations:f,left:m,right:f.length-m}).xRange=[22.5*(.5+T.left-1),22.5*(.5+T.right)],s.push(T),l=Math.max(l,22.5*f.length),c=Math.max(c,T.xRange[1])}var w=this.svg.select("rect.bgRampEditor");0==w.size()&&(w=this.svg.append("rect").style("fill","#cccccc")),w.attr("width",l).attr("height",25.5*i.length),this.bgRect=w;var M=this.svg.selectAll("g.colorRows").data(s);(M=M.enter().append("g").merge(M)).exit().remove();for(var P=[0,0],k=0;k<s.length;k++){var T=s[k];P[0]=Math.max(P[0],T.xRange[0]),P[1]=Math.max(P[1],T.xRange[1])}M.attr("transform",(function(t,e){return"translate("+-t.xRange[0]+","+25.5*e+")"})),function(t,o){o.each((function(o,a){d3.select(this).attr("id","editor_row_"+a);var i=d3.select(this).selectAll("rect").data(o.gradations);(i=i.enter().append("rect").merge(i)).attr("x",(function(t,e){return 22.5*e})).attr("y",0).attr("width",n).attr("height",n).style("stroke","black").style("fill",(function(t){return t.color.toString()})).style("stroke-width",(function(t,e){return e==o.rowCenter-1?"2px":"0.5px"})).on("mouseover",(function(){t.cancelSelfRemove(),d3.select("#editor_row_"+a).selectAll("rect").style("stroke-width","0.5px"),d3.select(this).style("stroke-width","2px");var r=d3.lab(d3.select(this).style("fill"));opt.editKey(e,[r.l,r.a,r.b]),t.cancelSelfRemove()})).on("mouseout",(function(){opt.unedit(),d3.select("#editor_row_"+a).selectAll("rect").style("stroke-width",(function(t){return t.original?"2px":"0.5px"})),t.selfRemove()})).on("click",(function(){var o=d3.lab(d3.select(this).style("fill"));scaffold.addEditedColorPref(e,r,[o.l,o.a,o.b]),opt.scheduleReRun(),t.dispose()}))}))}(this,M),this.globalRange=P},RampEditor.prototype.centerAt=function(t,e){var r=this.bgRect;r.style("pointer-events","none");var o=t,a=e;bgX=-this.globalRange[0],bgW=this.globalRange[0]+this.globalRange[1],r.attr("x",bgX).attr("width",bgW).style("pointer-events",null);var i,n=o;bgX+n<0?n+=-bgX-n:bgX+o+bgW>this.uiWidth&&(n-=bgX+o+bgW-this.uiWidth),this.svg.attr("transform","translate("+n+","+a+")"),i=this,r.on("mouseout",(function(){d3.mouse(this),i.selfRemove()})).on("mouseover",(function(){i.cancelSelfRemove()}))};var DEFAULT_BLOCK_SIZE=.1,MIN_BLOCK_SIZE=.05;function ColormapScaffold(t,e,r){this.svg=t,this.gradients=this.svg.append("g"),this.userPrefColors=this.svg.append("g"),this.highlights=this.svg.append("g"),this.keyIndexedPrefs={},this.w=e,this.h=r,this.userPrefs=[],this.createUI()}ColormapScaffold.prototype.getUIWidth=function(){return this.w},ColormapScaffold.prototype.getImagePlaceholder=function(){return this.imageGroup},ColormapScaffold.prototype.getRampEditorPlaceholder=function(){return this.rampEditorGroup},ColormapScaffold.prototype.addCallback=function(t){let e=scaffold.copyUserPrefs();e.sort(((t,e)=>t.mu-e.mu));let r=[];for(let s=0,l=e.length-1;s<l;s++){var o=e[s].color,a=e[s+1].color,i=cie2000Diff({l:o.l,a:o.a,b:o.b},{l:a.l,a:a.a,b:a.b}),n=Math.abs(e[s].mu-e[s+1].mu);"diverging"==t&&e[s].end<.5&&e[s+1].start>.5||"wave"==t&&(e[s].end<.33&&e[s+1].start>.33||e[s].end<.66&&e[s+1].start>.66)||r.push({col1:o,col2:a,cie00:i,userDist:n})}d3.selectAll("text#alertSign").remove()},ColormapScaffold.prototype.clear=function(){console.log("clearing"),this.userPrefs=[],this.storedPrefs=null,this.updateUserPrefs(),this.updateAllGradients()},ColormapScaffold.prototype.createUI=function(){this.rect=this.svg.append("rect").attr("id","colormapDrop").attr("x",0).attr("y",-4.5).style("fill","none").style("stroke","black").style("stroke-width","1px").attr("width",this.w).attr("height",this.h+9).attr("stroke-dasharray","4 1"),this.prompt=this.svg.append("text").attr("text-anchor","middle").attr("x",this.w/2).attr("y",this.h+9-20).html("add preferred colors here (if desired)").style("fill","#bababa").style("stroke","none").style("font-size",.6*this.h),this.svg.append("image").attr("y",this.h/2-10-20+5).attr("x",this.w+4).attr("width",20).attr("xlink:href","profile/replay.png").style("opacity",.2).on("mouseover",(function(){d3.select(this).style("opacity",1)})).on("mouseout",(function(){d3.select(this).style("opacity",.2)})).on("click",(function(){opt.scheduleReRun(!0,!0)})),this.svg.append("image").attr("y",this.h-20).attr("x",this.w+4).attr("width",20).attr("xlink:href","profile/trash.png").style("opacity",.2).on("mouseover",(function(){d3.select(this).style("opacity",.8)})).on("mouseout",(function(){d3.select(this).style("opacity",.2)})).on("click",(function(){scaffold.clear(),scaffold.triggerCallbacks()})),this.imageGroup=this.svg.append("g").attr("transform","translate(0,"+(this.h+15)+")"),this.image=this.imageGroup.append("image").attr("id","colormapImage").attr("x",0).attr("y",this.h).attr("width",this.w).attr("height",this.h).style("stroke","black"),this.downArrow=this.imageGroup.append("text").attr("id","downArrow").attr("class","fa").attr("x",COLORMAP_W+3).attr("y",this.h+COLORMAP_H/2+20).style("font-size",28).attr("fill","#222021").html(null),this.upArrow=this.imageGroup.append("text").attr("id","upArrow").attr("class","fa").attr("x",COLORMAP_W+3).attr("y",this.h+COLORMAP_H/2).style("font-size",28).attr("fill","#222021").html(null),this.statusText=this.imageGroup.append("text").attr("id","statusText").attr("x",this.w).attr("y",this.h-3).attr("text-anchor","end").attr("class","smallText"),this.rampEditorGroup=this.imageGroup.append("g").attr("transform","translate(0,"+(this.h+3)+")"),d3.select("#colormapImage").on("mousemove",(function(){if(!COLOR_DRAGGING&&!COLOR_MOVING){var t=scaffold.getRampEditorPlaceholder(),e=d3.mouse(t.node()),r=d3.mouse(this)[0]/+d3.select(this).attr("width"),o=opt.getColorMap(),a=RAMP_EDITOR;if(o&&!opt.isRunning()){RAMP_EDITOR||(a=new RampEditor(t,scaffold.getUIWidth()),RAMP_EDITOR=a);var i=opt.getColorMap().mapValue(r),n=opt.getSolution(),s=Math.min(n.length-1,Math.floor(.5+r*(n.length-1)));a.render(i,s,s/(n.length-1)),a.centerAt(e[0],-55.5)}}})).on("mouseout",(function(){RAMP_EDITOR&&RAMP_EDITOR.selfRemove()})),SelectorEvent(this)};var COLOR_DRAGGING=!1,COLOR_MOVING=!1;function SelectorEvent(t){var e;e=t,d3.select("#selectedColor").on("mousedown",(function(){e.prompt.style("visibility","hidden"),e.highlightPotentialDrop(d3.select("#selectedColor").style("fill")),d3.select(document).on("mousemove.selector",(function(){!function(){var t=d3.mouse(d3.select("#svgMain").node()),e=d3.select("#svgMain");if(LAST_MOUSE)r=d3.select("#dragSelector"),Date.now()-DRAG_START<DRAG_TRANSITION?r.transition().duration(DRAG_TRANSITION-(Date.now()-DRAG_START)).attr("x",t[0]+DRAG_OFFSET).attr("y",t[1]+DRAG_OFFSET).attr("width",DRAG_WH).attr("height",DRAG_WH):r.attr("x",t[0]+DRAG_OFFSET).attr("y",t[1]+DRAG_OFFSET);else{COLOR_DRAGGING=!0;var r,o=d3.select("#selectedColor");(r=e.append("rect").attr("id","dragSelector").attr("x",o.attr("x")).attr("y",o.attr("y")).attr("width",o.attr("width")).attr("height",o.attr("height")).style("fill",o.style("fill")).style("stroke",o.style("stroke")).style("stroke-width",o.style("stroke-width"))).transition().duration(70).attr("x",t[0]+DRAG_OFFSET).attr("y",t[1]+DRAG_OFFSET).attr("width",DRAG_WH).attr("height",DRAG_WH),DRAG_START=Date.now()}LAST_MOUSE=t}(),e.manipulation=!0})),d3.select(document).on("mouseup.selector",(function(){0==e.userPrefs&&e.prompt.style("visibility",null),COLOR_DRAGGING=!1,LAST_MOUSE=null,e.highlightPotentialDrop();var t=e.dropColor(d3.select("#selectedColor").style("fill"));e.manipulation=!1,d3.select(document).on("mousemove.selector",null),d3.select(document).on("mouseup.selector",null),t&&(e.triggerCallbacks(),e.addCallback(getLuminanceProfile()))}))}))}function DataGenerator(t){this.field=t,this.data=t.view}function TerrainGenerator(t){DataGenerator.call(this,t),this.terrainGen=new Terrain(Math.log2(t.w-1),this.data)}function NoiseGenerator(t,e){DataGenerator.call(this,t),this.noiseScale=e}function SineGenerator(t){DataGenerator.call(this,t),this.noiseScale=noiseScale}function ScalarExamples(t){this.canvases=[],this.fields=[],this.visualizers=[],this.generators=[],this.standalone=[];for(var e=0;e<t.length;e++){var r=t[e],o=r.width,a=r.height,i=new ScalarField(o,a);this.fields.push(i),this.canvases.push(r);var n=new ScalarVis(i,r);this.visualizers.push(n);var s=null;switch(e){case 0:s=new NoiseGenerator(i,1);break;case 1:s=new NoiseGenerator(i,3);break;case 2:s=new SineGenerator(i);break;default:s=new TerrainGenerator(i)}this.generators.push(s)}this.refresh()}ColormapScaffold.prototype.copyUserPrefs=function(){for(var t=[],e=0;e<this.userPrefs.length;e++)t.push(this.userPrefs[e].copy());return t},ColormapScaffold.prototype.dropColor=function(t){var e=this.inDropZone();if(e.inZone){var r=e.nPos,o=d3.lab(t);d3.select("#dragSelector").remove();var a=r,i=r+DEFAULT_BLOCK_SIZE;return a<0?i=(a=0)+DEFAULT_BLOCK_SIZE:i>1&&(a=(i=1)-DEFAULT_BLOCK_SIZE),this.userPrefs.push(new ColorPreference(a,i,o)),this.updateUserPrefs(),!0}return d3.select("#dragSelector").transition(DRAG_TRANSITION).attr("x",d3.select("#selectedColor").attr("x")).attr("y",d3.select("#selectedColor").attr("y")).attr("width",d3.select("#selectedColor").attr("width")).attr("height",d3.select("#selectedColor").attr("height")).on("end",(function(){d3.select(this).remove()})),!1},ColormapScaffold.prototype.removeColorPref=function(t){if(Number.isInteger(t)){var e=t;t=this.userPrefs[e],this.userPrefs.splice(e,1)}else for(var r=0;r<this.userPrefs.length;r++)this.userPrefs[r]==t&&this.userPrefs.splice(r,1);for(key in this.keyIndexedPrefs)this.keyIndexedPrefs.hasOwnProperty(key)&&this.keyIndexedPrefs[key]==t&&(this.keyIndexedPrefs[key]=void 0);this.userPrefs.length>0?this.prompt.style("visibility","hidden"):this.prompt.style("visibility",null)},ColormapScaffold.prototype.addEditedColorPref=function(t,e,r,o){o||(o=1.5*MIN_BLOCK_SIZE);var a=e-o/2,i=e+o/2;a<0?i=(a=0)+o:i>1&&(a=(i=1)-o);var n=d3.lab(r[0],r[1],r[2]),s=this.keyIndexedPrefs[t];s?(s.start=a,s.end=i,s.color=n):(s=new ColorPreference(a,i,n),this.userPrefs.push(s)),this.updateUserPrefs()},ColormapScaffold.prototype.cancelOpt=function(){opt.cancelScheduledRun()},ColormapScaffold.prototype.triggerCallbacks=function(){console.log("scaffold: triggerCallbacks"),opt.scheduleReRun(!0)},ColormapScaffold.prototype.layoutBlocks=function(){if(this.userPrefs&&0!=this.userPrefs.length){for(var t=this.userPrefs,e=[],r=0;r<t.length;r++)t[r].intersections=[];for(var o=1,a=(r=1,t.length);r<a;r++)for(var i=0;i<r;i++){var n=t[r],s=t[i];n.start,n.end;n.testIntersection(s)&&(n.intersections.push(s),s.intersections.push(n),o=Math.max(Math.max(o,n.intersections.length+1),s.intersections.length+1))}var l=t.slice();l.sort((function(t,e){var r=t.intersections.length-e.intersections.length;return 0==r?t.serial-e.serial:r}));for(var c=!1;!c;){e=[];for(r=0;r<o;r++)e.push([]);for(r=0;r<l.length;r++){for(var h=l[r],u=o-h.intersections.length,d=!1,p=0;!d&&p<=o-u;p++){for(var g=!0,f=p;f<p+u;f++){var m=e[f],v=!1;for(i=0;i<m.length;i++){var b=m[i];v=v||b.testIntersection(h)}if(v){g=!1;break}}if(g){for(f=p;f<p+u;f++){(m=e[f]).push(h)}h.startLevel=p,h.endLevel=p+u-1,h.levelsOccupied=u,h.h=h.levelsOccupied*(this.h/o),h.y=h.startLevel*(this.h/o),d=!0}}if(!d)break;c=!0}}return e}},ColormapScaffold.prototype.updateAllGradients=function(){this.userPrefs.length>0?this.prompt.style("visibility","hidden"):this.prompt.style("visibility",null);var t,e=this.gradients.selectAll("image.userPrefGradient").data(this.userPrefs);if(e.exit().remove(),e=e.enter().append("image").attr("class","userPrefGradient").merge(e),t=this.w,this.h,e.attr("x",(function(e){return e.start*t})).attr("y",(function(t){return t.y})).attr("width",(function(e){return(e.end-e.start)*t})).attr("height",(function(t){return t.h})).attr("id",(function(t){return"gradient_"+t.serial})).attr("xlink:href",(function(e){var r=Math.floor(+d3.select(this).attr("width")),o=+d3.select(this).attr("height");return e.renderGradient(r,o,t).toDataURL()})),this.callbacks)for(var r=0;r<this.callbacks.length;r++)this.callbacks[r]()},ColormapScaffold.prototype.updateBlockHeights=function(){0!=this.userPrefs.length&&(this.layoutBlocks(),this.colorBlockSelection&&this.colorBlockSelection.attr("height",(function(t){return t.h})).attr("y",(function(t){return t.y})),this.updateAllGradients(this.userPrefs))},ColormapScaffold.prototype.setNewPrefs=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].copy());this.storedPrefs=e,this.updateUserPrefs(e)},ColormapScaffold.prototype.flashUserPrefs=function(t){this.storedPrefs||(this.storedPrefs=this.userPrefs),this.updateUserPrefs(t)},ColormapScaffold.prototype.restoreUserPrefs=function(){this.userPrefs=this.storedPrefs,this.updateUserPrefs(),this.storedPrefs=null},ColormapScaffold.prototype.updateUserPrefs=function(t){t&&(this.userPrefs=t);this.layoutBlocks();var e=this.userPrefColors.selectAll("rect.userPrefColors").data(this.userPrefs),r=this.w;e.exit().remove(),(e=e.enter().append("rect").attr("class","userPrefColors").merge(e)).attr("x",(function(t){return t.start*r})).attr("y",(function(t){return t.y})).attr("width",(function(t){return(t.end-t.start)*r})).attr("height",(function(t){return t.h})).style("stroke","black").style("stroke-width","1px").style("fill","white").style("fill-opacity",0),this.colorBlockSelection=e,this.updateAllGradients(),function(t,e){t.on("mouseover",(function(t){e.manipulation||(putNodeOnTop(this),d3.event.stopPropagation(),d3.selectAll("rect.userPrefColors").each((function(t,e){t.order=e})),e.userPrefs.sort((function(t,e){return t.order-e.order})))})).on("mousemove",(function(t){if(!e.manipulation){var r=+d3.select(this).attr("x"),o=+d3.select(this).attr("width"),a=d3.mouse(e.userPrefColors.node());a[0]-=r,a[0]<5?(e.resizeTarget={d:t,node:this,originalW:+d3.select(this).attr("width"),originalX:+d3.select(this).attr("x"),edge:"left"},d3.select(this).style("cursor","col-resize")):a[0]>5&&a[0]>o-5?(e.resizeTarget={d:t,node:this,originalW:+d3.select(this).attr("width"),originalX:+d3.select(this).attr("x"),edge:"right"},d3.select(this).style("cursor","col-resize")):(e.resizeTarget=null,d3.select(this).style("cursor",null))}})).on("mousedown",(function(t,r){e.cancelOpt(),e.manipulation=!0,e.mouseDown=d3.mouse(d3.select("#colormapDrop").node()),COLOR_MOVING=!0,e.resizeTarget?d3.select(document).on("mousemove.moveColors",(function(){var t=d3.mouse(d3.select("#colormapDrop").node()),r=[t[0]-e.mouseDown[0],t[1]-e.mouseDown[1]],o=d3.select(e.resizeTarget.node),a=e.resizeTarget.originalX,i=e.resizeTarget.originalW;"left"==e.resizeTarget.edge?((a=r[0]+e.resizeTarget.originalX)<0?a=0:(e.resizeTarget.originalW+e.resizeTarget.originalX-a)/e.w<MIN_BLOCK_SIZE&&(a=-MIN_BLOCK_SIZE*e.w+e.resizeTarget.originalW+e.resizeTarget.originalX),o.attr("x",a),i=e.resizeTarget.originalW+e.resizeTarget.originalX-a,o.attr("width",i)):((i=r[0]+e.resizeTarget.originalW)<MIN_BLOCK_SIZE*e.w?i=MIN_BLOCK_SIZE*e.w:e.resizeTarget.originalX+i>e.w&&(i=e.w-e.resizeTarget.originalX),o.attr("width",i));var n=a/e.w,s=(a+i)/e.w;e.resizeTarget.d.update(n,s),e.updateBlockHeights()})).on("mouseup.moveColors",(function(){COLOR_MOVING=!1,e.manipulation=!1,d3.select(document).on("mousemove.moveColors",null).on("mouseup.moveColors",null),e.triggerCallbacks(),e.addCallback(getLuminanceProfile())})):(e.moveTarget={index:r,d:t,node:this,originalX:+d3.select(this).attr("x")},d3.select(document).on("mousemove.moveColors",(function(){var t=d3.mouse(d3.select("#colormapDrop").node()),r=[t[0]-e.mouseDown[0],t[1]-e.mouseDown[1]],o=d3.select(e.moveTarget.node),a=r[0]+e.moveTarget.originalX;a<0?a=0:a+ +o.attr("width")>e.w&&(a=e.w-o.attr("width")),o.attr("x",a);var i=a/e.w,n=(a+ +o.attr("width"))/e.w;e.moveTarget.d.update(i,n);var s=d3.mouse(e.userPrefColors.node());s[1]<-20||s[1]>e.h+20||s[0]<-20||t[0]>e.w+20?(o.style("opacity",.2),d3.select("#gradient_"+e.moveTarget.d.serial).style("opacity",.2),e.moveTarget.trash=!0,d3.select("body").attr("class","trashCan")):(o.style("opacity",null),d3.select("#gradient_"+e.moveTarget.d.serial).style("opacity",null),e.moveTarget.trash=!1,d3.select("body").attr("class","")),e.updateBlockHeights()})).on("mouseup.moveColors",(function(){if(COLOR_MOVING=!1,d3.select("body").attr("class",""),e.manipulation=!1,d3.select(document).on("mousemove.moveColors",null).on("mouseup.moveColors",null),e.moveTarget.trash){for(var t=0;t<e.userPrefs.length;t++)e.userPrefs[t].serial==e.moveTarget.d.serial&&e.removeColorPref(t);d3.select("#gradient_"+e.moveTarget.d.serial).remove(),d3.select(e.moveTarget.node).transition().duration(100).attr("width",0).attr("height",0).on("end",(function(){d3.select(this).remove(),e.updateBlockHeights()}))}e.triggerCallbacks(),e.addCallback(getLuminanceProfile())})))}))}(e,this)},ColormapScaffold.prototype.inDropZone=function(t){t||(t=d3.mouse(this.svg.node()));var e=+this.rect.attr("x"),r=+this.rect.attr("x")+ +this.rect.attr("width"),o=+this.rect.attr("y"),a=+this.rect.attr("y")+ +this.rect.attr("height"),i=t[0]>=e&&t[0]<=r&&t[1]>=o&&t[1]<=a;return{nPos:(t[0]-e)/(r-e),inZone:i}},ColormapScaffold.prototype.highlightPotentialDrop=function(t){if(t){var e=this.getDropRange(t),r=this.w,o=(this.h,this.highlights.selectAll("rect.potentialDrop").data(e));(o=o.enter().append("rect").attr("class","potentialDrop").merge(o)).attr("x",(function(t){return t[0]*r})).attr("width",(function(t){var e=t[0]*r;return t[1]*r-e})).attr("y",5).attr("height",this.h-10).style("fill",t),o.exit().remove()}else this.highlights.selectAll("rect.potentialDrop").remove()},ColormapScaffold.prototype.getDropRange=function(t){for(var e=d3.lab(t),r=(e.l,e.l,!1),o=[],a=null,i=getLuminanceProfile(),n=0;n<=1e3;n++){var s=n/1e3;e.l=i.getLuminance(s),e.displayable()?r?a[1]=s:(r=!0,a=[s,s]):r&&(o.push(a),a=null,r=!1)}return a&&(a[1]=1,o.push(a)),o},ColormapScaffold.prototype.getUserPrefs=function(){return this.userPrefs},DataGenerator.prototype.generate=function(t){console.error("DataGenerator abstract not implemented")},TerrainGenerator.prototype=Object.create(DataGenerator),TerrainGenerator.prototype.generate=function(t){this.terrainGen.generate(.5)},NoiseGenerator.prototype=Object.create(DataGenerator),NoiseGenerator.prototype.generate=function(){seedNoise(),makeNoise(this.field,this.noiseScale)},SineGenerator.prototype=Object.create(DataGenerator),SineGenerator.prototype.generate=function(){for(var t=this.field,e=this.field.view,r=Math.min(t.w,t.h)/4,o=0,a=0;a<t.h;a++)for(var i=a/r,n=Math.sin(2*i*Math.PI),s=0;s<t.w;s++,o++){var l=s/r,c=1;if(i>=2&&i<=3&&l>=2&&l<=3){var h=Math.sqrt(Math.pow(i-2.5,2)+Math.pow(l-2.5,2));h<=.6&&(c=1-(.6-h)/.6*.8)}var u=Math.sin(2*l*Math.PI);e[o]=c*(n+u)}},ScalarExamples.prototype.addStandalone=function(t,e){for(var r=0;r<this.standalone.length;r++)this.standalone[r].vis.dispose();this.standalone=[];var o=new ScalarVis(t,e);this.standalone.push({vis:o,field:t}),opt.getColorMap()&&t.setColorMap(opt.getColorMap()),o.vis()},ScalarExamples.prototype.refresh=function(){for(var t=0;t<this.generators.length;t++)this.generators[t].generate(),this.fields[t].normalize(),this.fields[t].updated(),this.visualizers[t].vis();for(t=0;t<this.standalone.length;t++)this.standalone[t].vis.vis()},ScalarExamples.prototype.setColorMap=function(t){ScalarVis.setUniversalColormap(t)};var combinedMapModule=function(){var t,e,r=d3.map(),o=d3.map();return{createChoroplethMap1:function(e){d3.select("div#map1 svg").remove(),d3.csv("profile/unemployment.csv").then((function(o){o.forEach((function(t){r.set(t.id,+t.rate)})),d3.xml("profile/mod.svg").then((function(r){var o=document.importNode(r.documentElement,!0);t=d3.select(o),d3.select("div#map1").node().appendChild(t.node()),"function"==typeof e&&e()})).catch((function(t){throw t}))}))},createChoroplethMap2:function(t){d3.select("div#map2 svg").remove(),d3.xml("profile/new.svg").then((function(r){var a=document.importNode(r.documentElement,!0);e=d3.select(a),d3.select("div#map2").node().appendChild(e.node()),e.selectAll("path").each((function(t,e){var r;if(e>=1500)r=parseFloat(50*Math.random());else{var a=1*Math.floor(e/30),i=a+1;r=parseFloat(Math.random()*(i-a)+a)}o.set(e,r)})),"function"==typeof t&&t()})).catch((function(t){throw t}))},updateChoroplethMap1:function(e){var o=(e?.colorMap??[{value:0,lab:{l:0,a:0,b:0}},{value:1,lab:{l:100,a:0,b:0}}]).map((function(t){return d3.lab(t.lab.l,t.lab.a,t.lab.b).hex()})),a=d3.scaleSequential().domain([Math.min(...Array.from(r.values())),Math.max(...Array.from(r.values()))]).interpolator(d3.interpolateRgbBasis(o)),i=r.keys();t.selectAll("path").attr("fill",(function(t,e){var o=r.get(i[e]);return o?a(o):"gray"}))},updateChoroplethMap2:function(t){var r=(t?.colorMap??[{value:0,lab:{l:0,a:0,b:0}},{value:1,lab:{l:100,a:0,b:0}}]).map((function(t){return d3.lab(t.lab.l,t.lab.a,t.lab.b).hex()})),a=d3.scaleSequential().domain([Math.min(...Array.from(o.values())),Math.max(...Array.from(o.values()))]).interpolator(d3.interpolateRgbBasis(r));e.selectAll("path").attr("fill",(function(t,e){var r=o.get(e);return r?a(r):"gray"}))}}}();async function loadBinaryFile(t){const e=await fetch(t),r=await e.arrayBuffer();return new DataView(r)}async function loadAndDisplayImage(){const t=document.getElementById("binaryFile");if(0==t.files.length)return void alert("Please specify a binary scalar file to visualize.");const e=URL.createObjectURL(t.files[0]),r=document.getElementById("imageWidth").value,o=document.getElementById("imageHeight").value;if(""==r||""==o||isNaN(parseInt(r))||isNaN(parseInt(o)))alert("Width and height should be whole numbers.");else{var a=parseInt(r),i=parseInt(o);if(a<0||i<0)alert("Width and height should be positive numbers.");else{var n=document.querySelector('input[name="format"]:checked').value,s=await visualizeBinFile(e,a,i,n);"success"!=s?alert(s):closePopup()}}}function ImageAccess(t){var e=t.getContext("2d");this.imageData=e.getImageData(0,0,t.width,t.height).data,this.byteLength=4*t.width*t.height}ImageAccess.prototype.getPixel=function(t){return.3*this.imageData[t]+.59*this.imageData[t+1]+.11*this.imageData[t+2]};var customFileSeq=1;async function visualizeBinFile(t,e,r,o,a,i){var n;null==a&&(a=!1);var s=null,l=null;if("canvas"==o)s=4,l=(n=new ImageAccess(t)).getPixel;else switch(n=await loadBinaryFile(t),o){case"int16":s=2,l=n.getInt16;break;case"uint16":s=2,l=n.getUint16;break;case"int32":s=4,l=n.getInt32;break;case"uint32":s=4,l=n.getUint32;break;case"float32":s=4,l=n.getFloat32;break;case"float64":s=8,l=n.getFloat64;break;default:return console.error("Invalid format: "+o),"Invalid format: "+o}var c=e*r*s;if(n.byteLength!=c){var h="File size of "+n.byteLength+" does not match expectation of "+c+".";return console.error(h),h}for(var u=270,d=Math.floor(u/e*r+.5),p=new ScalarField(u,d),g=p.view,f=0,m=0;m<d;m++)for(var v=0;v<u;v++,s,f++){var b,y=v/u*(e-1),C=m/d*(r-1),x=Math.floor(y),S=Math.floor(C),R=S*e+x,w=S*e+x+1,M=(S+1)*e+x,P=(S+1)*e+x+1,k=l.call(n,R*s,a),T=l.call(n,w*s,a),E=l.call(n,M*s,a),A=l.call(n,P*s,a);b=k==i||T==i||E==i||A==i?SCALAR_EMPTY:blerp(k,T,E,A,y-x,C-S),g[f]=b}p.normalize();var _=d3.select("#binimage1");return _.selectAll("canvas").remove(),_.append("canvas").attr("id","customFile_"+customFileSeq++),canvasSel=_.select("canvas"),canvasSel.attr("width",u).attr("height",d),examples.addStandalone(p,canvasSel.node()),"success"}function onChangeUpload(t){if(t.length>0&&t[0].name.match(/\.(jpg|jpeg|png|gif)$/)){var e=new FileReader;e.onloadend=function(){var t=new Image;t.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height,e.getContext("2d").drawImage(this,0,0,this.width,this.height);visualizeBinFile(e,t.width,t.height,"canvas");closePopup()},t.src=e.result},e.readAsDataURL(t[0])}}var CONCURRENT_WORKER=10;function JSON2CSV(t){var e="object"!=typeof t?JSON.parse(t):t,r="",o="";e[0];if($("#quote").is(":checked"))for(var a in e[0]){o+='"'+(a+"").replace(/"/g,'""')+'",'}else for(var a in e[0])o+=a+",";r+=(o=o.slice(0,-1))+"\r\n";for(var i=0;i<e.length;i++){o="";if($("#quote").is(":checked"))for(var a in e[i]){o+='"'+(e[i][a]+"").replace(/"/g,'""')+'",'}else for(var a in e[i])o+=e[i][a]+",";r+=(o=o.slice(0,-1))+"\r\n"}return r}function downloadCSV(t){json_pre=JSON.stringify(t);var e=JSON2CSV($.parseJSON(json_pre)),r=document.createElement("a"),o=new Blob(["\ufeff",e]),a=URL.createObjectURL(o);r.href=a,r.download="data.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r)}var BENCHMARKS={viridis:[d3.interpolateViridis,"linear"],plasma:[d3.interpolatePlasma,"linear"],cubehelix:["cubehelix","linear"],blues:[d3.interpolateBlues,"linear"],greenBlue:[d3.interpolateGnBu,"linear"],redBlue:[d3.interpolateRdBu,"diverging"],spectral:[d3.interpolateSpectral,"diverging"],redGrey:[d3.interpolateRdGy,"diverging"],purpleGreen:[d3.interpolatePRGn,"diverging"],d3rainbow:["d3rainbow","diverging"],coolwarmMoreland:["coolwarmMoreland","diverging"]};function Simulator(t){t||(t=50),this.n=t,this.running=0,this.workerPool=[],this.workerCount=0,this.data=[],this.lum=getLuminanceProfile(),this.refreshWorkers()}function labLength(t){for(var e=0,r=0;r<t.length-1;r++){var o=t[r],a=t[r+1],i=d3.lab(o[0],o[1],o[2]),n=d3.lab(a[0],a[1],a[2]);e+=Math.sqrt(Math.pow(i.l-n.l,2)+Math.pow(i.a-n.a,2)+Math.pow(i.b-n.b,2))}return e}function avgChroma(t){for(var e=0,r=0;r<t.length;r++){var o=t[r],a=d3.lab(o[0],o[1],o[2]),i=d3.hcl(a);isNaN(i.c)||(e+=i.c)}return e/t.length}function globalDistance(t){for(var e=0,r=0,o=1,a=t.length;o<a;o++)for(var i=t[o],n=d3.lab(i[0],i[1],i[2]),s=0;s<o;s++){var l=t[s],c=d3.lab(l[0],l[1],l[2]);e+=_cie2000Diff(n,c),r++}return r>0?e/r:0}var _cvd_model=new ColorTransform(CVD_MATRIX.deuteranomaly);function gaussian(t,e,r){const o=Math.sqrt(2*Math.PI);var a=r*r;return Math.exp(-.5*Math.pow(t-e,2)/a)/(r*o)}Simulator.prototype.evaluateSolution=function(t,e,r){var o=t.solution,a=perceptualUniformityPenalty(o),i=anglePenalty(o),n=this.lum.getKeyMultiples(Math.floor(.5*o.length)),s=anglePenalty(o,n),l=labLength(o),c=[],h=_cvd_model||getCVDModel();if(h)for(var u=0;u<o.length;u++){var d=o[u],p=h.transformLAB(d3.lab(d[0],d[1],d[2]));c.push([p.l,p.a,p.b])}return{id:e||"solution"+(1+this.data.length),smoothness1:i,smoothness2:s,uniformity:a,chroma:avgChroma(o),globalDiscriminability:globalDistance(o),labLength:l,logLabLength:Math.log(l),time:t.totalTime||0,profile:r||this.lum.profileType,cvdDiscriminability:h?globalDistance(c):0}},Simulator.prototype.refreshWorkers=function(){if(this.data.length>=this.n)return!0;for(var t=this.running;t<CONCURRENT_WORKER&&this.workerCount<this.n;t++){var e=new WorkerControl(1);e.updateEvery=null,this.workerCount++,function(t,e,r){r.running++,LRANGE[0]=5+Math.floor(.5+10*Math.random()),LRANGE[1]=95-Math.floor(.5+10*Math.random()),t.startWork((function(e,o){if(o){r.running--;var a=r.evaluateSolution(e[0]);if(r.data.push(a),t.stopWork(),r.data.length==r.n){for(name in BENCHMARKS)if(BENCHMARKS.hasOwnProperty(name)){var i=BENCHMARKS[name][0],n=BENCHMARKS[name][1],s=null;("string"==typeof i||i instanceof String)&&(s=getColorPreset(i));for(var l=[],c=0,h=e[0].solution.length;c<h;c++){var u=c/(h-1),d=d3.lab(s?s.mapValue(u):i(u));l.push([d.l,d.a,d.b])}r.data.push(r.evaluateSolution({solution:l},name,n))}downloadCSV(r.data)}else console.log("complete: "+(100*r.data.length/r.n).toFixed(2)+"%"),r.refreshWorkers()}}))}(e,0,this)}return!1};var MAX_HARD_KEYS=4,HIGH_IMPORTANCE=1,SERIAL=0,MAX_PREF_STRENGTH=gaussian(0,0,2*MIN_BLOCK_SIZE);function ColorPreference(t,e,r){this.update(t,e),this.color=r,this.serial=SERIAL++}function UserModel(t){this.hardKeys=[],this.updateBiasVectors(t)}function isNumber(t){return"number"==typeof t&&isFinite(t)}function addMMCallback(t,e,r,o,a,i,n,s){function l(t,e){return d3.mouse(e||t.node())}function c(e,r){var o=l(e,r);o[0]<0&&(o[0]=0),o[1]<0&&(o[1]=0);var a=(r?d3.select(r):t).attr("width"),i=(r?d3.select(r):t).attr("height");return[Math.min(1,o[0]/+a),Math.min(1,o[1]/+i)]}t.on("mouseover",(function(){var r=c(t,e);mDown=l(t,e),i&&i(r[0],r[1])})),t.on("mouseout",(function(){var r=c(t,e);mDown=l(t,e),n&&n(r[0],r[1])})),t.on("mousedown",(function(){var i=c(t,e);mDown=l(t,e),minDistanceAchieved=!isNumber(s),o&&o(i[0],i[1]),d3.select(document).on("mousemove.mMove",(function(){var o=c(t,e);if(!minDistanceAchieved){var a=l(t,e),i=[a[0]-mDown[0],a[1]-mDown[1]];if(Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2))<s)return;minDistanceAchieved=!0}r(o[0],o[1])})),d3.select(document).on("mouseup.mMove",(function(){a&&a(),d3.select(document).on("mousemove.mMove",null).on("mouseup.mMove",null)}))}))}function ShadowedText(t,e,r,o){this.g=t.append("g"),this.x=r||0,this.y=o||0,this.g.attr("transform","translate("+this.x+","+this.y+")"),this.light=this.g.append("text").html(e||"").style("fill","white"),this.dark=this.g.append("text").html(e||null).style("fill","black").attr("x",-1).attr("y",-1)}function putNodeOnTop(t){var e=jQuery(t);e.parent().append(e.detach())}function trimColorToGamut(t,e){var r=.5;function o(t){return t>=0?1:-1}e||(e=d3.lab);for(var a=e(t.l,t.a,t.b);!a.displayable()&&0!=a.a&&0!=a.b;){0!=a.a&&(0==a.b||Math.abs(a.a-t.a)<=Math.abs(a.b-t.b))?Math.abs(a.a)<r?a.a=0:a.a+=-1*o(a.a)*r:Math.abs(a.b)<r?a.b=0:a.b+=-1*o(a.b)*r}return a}function ThreadedOptimizer(t,e,r,o,a){this.controller=new WorkerControl(t),e&&(this.controller.initialTemp=e),r&&(this.controller.iterationsPerTemp=r),o&&(this.controller.taperWalkLen=o),a&&(this.controller.initialSolution=a)}function WorkerControl(t){this.workerCount=t,this.workers=[];for(var e=0;e<t;e++){var r=new Worker("worker.js");this.workers.push(r)}}ColorPreference.prototype.update=function(t,e){this.start=t,this.end=e,this.mu=.5*(this.start+this.end),this.sigma=.5*(this.end-this.start)},ColorPreference.prototype.copy=function(){var t=new ColorPreference(this.start,this.end,this.color);return t.update(this.start,this.end),t},ColorPreference.prototype.evaluateStrength=function(t){return gaussian(t,this.mu,this.sigma)},ColorPreference.prototype.getMaxStrength=function(){return gaussian(0,0,this.sigma)},ColorPreference.prototype.evaluateRelStrength=function(t){return this.evaluateStrength(t)/MAX_PREF_STRENGTH},ColorPreference.prototype.testIntersection=function(t){function e(t,e){var r=t.start,o=t.end;return e.start>=r&&e.start<=o||e.end>=r&&e.end<=o}return e(this,t)||e(t,this)},ColorPreference.prototype.renderGradient=function(t,e,r){var o=getLuminanceProfile(),a=document.createElement("canvas");a.width=t,a.height=e;for(var i=a.getContext("2d"),n=d3.lab(this.color),s=0;s<t;s+=1){var l=s/t*(this.end-this.start)+this.start;if(n.l=o.getLuminance(l),n.opacity=Math.max(1,1.5*this.evaluateRelStrength(l)),n.displayable())i.fillStyle=n.toString(),i.fillRect(s,0,1,e);else{var c=trimColorToGamut(n);c.opacity=n.opacity,i.fillStyle=c.toString(),i.fillRect(s,0,1,e)}}return a},UserModel.prototype.updateBiasVectors=function(t){t||(t=[]);for(var e=[],r=getLuminanceProfile().getKeyMultiples(),o=0;o<r;o++){for(var a=o/(r-1),i=[],n=0,s=t.length;n<s;n++){var l=t[n],c=(l.start+l.end)/2,h=(l.end-l.start)/2,u=(gaussian(a,c,h),gaussian(0,0,h),[l.color.l,l.color.a,l.color.b]);i.push({relativeStrength:l.evaluateRelStrength(a),preference:u})}e.push(i)}this.bias=e},UserModel.prototype.test=function(){console.log("test function")},UserModel.prototype.getBias=function(){for(var t=[],e=0,r=this.bias.length;e<r;e++)t.push(this.bias[e].slice());for(e=0,r=this.hardKeys.length;e<r;e++){var o=this.hardKeys[e];t[o.index].push({relativeStrength:MAX_PREF_STRENGTH*o.importance,preference:o.color})}return t},UserModel.prototype.addHardKey=function(t,e){for(var r=0;r<this.hardKeys.length;r++){this.hardKeys[r].index==t&&this.hardKeys.splice(r,1)}this.hardKeys.push({importance:1,index:t,color:e}),this.hardKeys.length>MAX_HARD_KEYS&&this.hardKeys.shift();r=0;for(var o=this.hardKeys.length-1;r<=o;r++){var a=Math.exp(-.6*(o-r));this.hardKeys[r].importance=a}},ShadowedText.prototype.textAnchor=function(t){this.light.attr("text-anchor",t),this.dark.attr("text-anchor",t)},ShadowedText.prototype.lightBackground=function(){return putNodeOnTop(this.dark.node()),this},ShadowedText.prototype.darkBackground=function(){return putNodeOnTop(this.light.node()),this},ShadowedText.prototype.attr=function(t,e){return this.g.selectAll("text").attr(t,e),this},ShadowedText.prototype.setText=function(t){this.dark.html(t),this.light.html(t)},ShadowedText.prototype.setX=function(t){return this.x=t,this.g.attr("transform","translate("+this.x+","+this.y+")"),this},ShadowedText.prototype.setY=function(t){return this.y=t,this.g.attr("transform","translate("+this.x+","+this.y+")"),this},ThreadedOptimizer.prototype.run=function(t){this.controller.startWork(t)},ThreadedOptimizer.prototype.stop=function(){this.controller.stopWork()},ThreadedOptimizer.prototype.getRemainingSeconds=function(){return this.controller.secondsRemaining},ThreadedOptimizer.prototype.getFirstSolution=function(){return this.controller.solutions&&this.controller.solutions[0]?this.controller.solutions[0].solution:null},WorkerControl.prototype.stopWork=function(){if(this.workers){for(var t=0;t<this.workers.length;t++)this.workers[t].terminate();this.workers=null}},WorkerControl.prototype.terminate=function(){this.stopWork()},WorkerControl.prototype.startWork=function(t,e){var r=getCVDModel(),o={luminanceProfile:getLuminanceProfile().getProfileType(),LRANGE:LRANGE,smoothness:SMOOTHNESS,desiredKeys:DESIRED_KEYS,exitEvery:void 0!==this.updateEvery?this.updateEvery:UPDATE_EVERY,iterationsPerTemp:ITERATIONS_PER_TEMP,minBlockSize:MIN_BLOCK_SIZE,maxPrefStrength:MAX_PREF_STRENGTH,cvdModel:r?r.modelName:null,initialTemp:this.initialTemp,alpha:this.alpha,taperWalkLen:this.taperWalkLen,initialSolution:this.initialSolution},a=new UserModel(scaffold?scaffold.getUserPrefs():null);o.userBias=a.getBias(),this.solutions=[],this.readyCount=0,this.startTime=Date.now();for(var i=this.workerCount,n=0;n<i;n++)this.solutions.push(null);for(n=0;n<i;n++)!function(e,r,a,n){e.onmessage=function(e){var r=e.data,o=!1;n.solutions[a]=r,n.estimateTimeRemaining(),r.complete&&(n.readyCount++,n.readyCount==i&&(o=!0)),t&&t(n.solutions,o)},o.workerIndex=a,e.postMessage(o)}(this.workers[n],0,n,this)},WorkerControl.prototype.estimateTimeRemaining=function(){if(this.secondsRemaining=void 0,this.readyCount!=this.workers.length){for(var t=0,e=0,r=0;r<this.solutions.length;r++)null!==this.solutions[r]&&(e++,t+=this.solutions[r].percentDone);if(e>0){var o=(this.workers.length-t)/t*(Date.now()-this.startTime),a=Math.ceil(o/1e3);this.secondsRemaining=a}}};var SOLUTION_SIMILARITY_THRESHOLD=120;function solutionDistance(t,e){for(var r=0,o=0;o<t.length;o++){var a=t[o],i=e[o];r+=Math.sqrt(Math.pow(a[0]-i[0],2)+Math.pow(a[1]-i[1],2)+Math.pow(a[2]-i[2],2))}return r}WorkerControl.prototype.aggregate=function(){for(var t=1;t<this.solutions.length;t++)for(var e=0;e<t;e++){var r=this.solutions[t],o=this.solutions[e];calcDistance(r,o)}};